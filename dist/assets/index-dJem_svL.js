import{B as e,u as a,f as t,a as s,r,Q as o,h as i,b as n,j as l}from"./index-DpP_SUQ6.js";import{P as m}from"./page-header-xlds1YNX.js";import{D as u}from"./dialog-button-DGmQezhZ.js";import{P as c}from"./pagination-DoocPit7.js";import{T as d}from"./table-CI8tVEnI.js";import{u as p}from"./use-room-Ckk35-Rt.js";import{I as f}from"./input-select-BvffwCdU.js";import{u as g,I as h}from"./input-text-Ds8sWXwC.js";import{u as b}from"./use-floor-BPVKtHXP.js";import"./useQuery-C6faGm9h.js";import"./isValid-5aXsojdQ.js";const j="https://booking-api.parokipik.org/admin/room";class x extends e{static async createRoom(e){return await this._post(`${j}`,e)}static async updateRoom(e,a){if(e)return await this._patch(`${j}/${e}`,a)}static async deleteRoom(e){if(e)return await this._delete(`${j}/${e}`,{})}}const y=r.forwardRef((({selectedRoom:e},m)=>{const{data:u,status:c}=b({order_by:"created_at",data_order:"asc"}),{register:d,setValue:p,errors:j,handleManageRoom:y,handleDeleteRoom:R,handleSubmit:_}=((e=null)=>{const{register:l,setValue:m,getValues:u,formState:{errors:c},handleSubmit:d,watch:p,reset:f}=g(),[h,b]=a(t),j=s();return r.useEffect((()=>{f(),e&&Object.keys(e).forEach((a=>{m(a,e[a])}))}),[e,m,f]),{register:l,setValue:m,getValues:u,errors:c,handleManageRoom:async function(a){h||(b(!0),e?await o.promise(x.updateRoom(e.id,a),{pending:"Waiting for update room!",error:n(),success:i()}):await o.promise(x.createRoom(a),{pending:"Waiting for create room!",error:n(),success:i()}),j.invalidateQueries({queryKey:["general/room"]}),null!==e&&j.invalidateQueries({queryKey:["general/room",e.id]}),f(),b(!1))},handleDeleteRoom:async function(){e&&(h||(b(!0),await o.promise(x.deleteRoom(e.id),{pending:"Waiting for delete room!",error:n(),success:i()}),b(!1),f(),j.invalidateQueries({queryKey:["general/room"]})))},handleSubmit:d,watch:p}})(e);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Ruangan":"Buat Ruangan"}),l.jsxs("form",{onSubmit:_((async e=>{await y(e),m.current?.close()})),className:"flex flex-col gap-2",children:[l.jsx(h,{label:"Nama Ruangan",type:"text",name:"name",register:d("name",{required:"Nama ruangan harus diisi"}),setValue:p,placeholder:"Cth: Bartolomeus",errors:j}),"success"===c?l.jsx(f,{label:"Lantai",name:"floor_id",register:d("floor_id",{required:"Lantai harus diisi"}),setValue:p,model:u??[],errors:j}):l.jsx(l.Fragment,{}),l.jsx(h,{label:"Kapasitas",type:"number",name:"capacity",register:d("capacity",{required:"Kapasitas harus diisi"}),min:1,setValue:p,errors:j}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>m.current?.close(),children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>(await R(),m.current?.close()),children:"Hapus"})]})]})]})})),R=[{name:"name",sortable:!0},{name:"floor_name",sortable:!0},{name:"items",sortable:!1}],_=()=>{const[e,a]=r.useState({page:1}),[t,s]=r.useState({order_by:"name",data_order:"asc"}),{data:o,status:i}=p(e,t,!0),n=o?.data.map((e=>{const a={...e,floor_name:e.floor.name,items:e?.room_items?.map((e=>e.item.name)).join(", "),item_id:e?.room_items?.map((e=>e.item_id))};return{...a,items:a.items?a.items:"-",onClick:()=>{g(a),h.current?.showModal()}}})),[f,g]=r.useState(),h=r.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(m,{pageName:"Ruangan",action:l.jsx(u,{buttonValue:"Tambah Ruangan",onClick:()=>g(void 0),ref:h,children:l.jsx(y,{selectedRoom:f,ref:h})})}),l.jsx(d,{header:R,data:n??[],status:i,sortData:t,setSortData:s,enableSort:!0}),l.jsx(c,{status:i,data:o,page:e.page,setPage:a})]})};export{_ as default};
