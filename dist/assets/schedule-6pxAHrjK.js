import{p as e,q as t,u as r,a as n,b as a,j as s,t as o,r as i,B as l,v as c,w as u}from"./index-DuxHCDsN.js";import{I as d}from"./InputText-ZWl9SnFl.js";import{A as m}from"./AlertContainer-DqQ9j59z.js";import{P as f}from"./PageHeader-Dvh_HQ7V.js";import{B as b,A as g}from"./constants-5vXSpW5c.js";import{f as h}from"./format-NlhdwbCv.js";import{u as x}from"./useQuery-G1tKG1h3.js";import"./startOfDay-Cqt31xqJ.js";import"./isValid-5aXsojdQ.js";import"./constructFrom-BpBbSY1L.js";var p,j,y,v,w,N,k,S,_,M,D,$,C,O,R,T,A,B,H,F,q,z,E,I,J,L,P,K,W,Z,G,Q,U,V,X,Y,ee,te,re,ne,ae,se,oe,ie;function le(){if(S)return k;S=1;var t=function(){if(N)return w;N=1;var t="object"==typeof e&&e&&e.Object===Object&&e;return w=t}(),r="object"==typeof self&&self&&self.Object===Object&&self,n=t||r||Function("return this")();return k=n}function ce(){if(M)return _;M=1;var e=le().Symbol;return _=e}function ue(){if(T)return R;T=1;var e=ce(),t=function(){if($)return D;$=1;var e=ce(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;return D=function(e){var t=r.call(e,a),s=e[a];try{e[a]=void 0;var o=!0}catch(l){}var i=n.call(e);return o&&(t?e[a]=s:delete e[a]),i}}(),r=function(){if(O)return C;O=1;var e=Object.prototype.toString;return C=function(t){return e.call(t)}}(),n=e?e.toStringTag:void 0;return R=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":n&&n in Object(e)?t(e):r(e)}}function de(){if(B)return A;return B=1,A=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}}function me(){if(I)return E;I=1;var e=function(){if(F)return H;F=1;var e=ue(),t=de();return H=function(r){if(!t(r))return!1;var n=e(r);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n}}(),t=z?q:(z=1,q=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991});return E=function(r){return null!=r&&t(r.length)&&!e(r)}}function fe(){if(K)return P;K=1;var e=v?y:(v=1,y=function(e,t){return e===t||e!=e&&t!=t}),t=me(),r=function(){if(L)return J;L=1;var e=/^(?:0|[1-9]\d*)$/;return J=function(t,r){var n=typeof t;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&e.test(t))&&t>-1&&t%1==0&&t<r}}(),n=de();return P=function(a,s,o){if(!n(o))return!1;var i=typeof s;return!!("number"==i?t(o)&&r(s,o.length):"string"==i&&s in o)&&e(o[s],a)}}function be(){if(Q)return G;Q=1;var e=function(){if(Z)return W;Z=1;var e=/\s/;return W=function(t){for(var r=t.length;r--&&e.test(t.charAt(r)););return r}}(),t=/^\s+/;return G=function(r){return r?r.slice(0,e(r)+1).replace(t,""):r}}function ge(){if(Y)return X;Y=1;var e=ue(),t=V?U:(V=1,U=function(e){return null!=e&&"object"==typeof e});return X=function(r){return"symbol"==typeof r||t(r)&&"[object Symbol]"==e(r)}}function he(){if(ne)return re;ne=1;var e=function(){if(te)return ee;te=1;var e=be(),t=de(),r=ge(),n=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;return ee=function(i){if("number"==typeof i)return i;if(r(i))return NaN;if(t(i)){var l="function"==typeof i.valueOf?i.valueOf():i;i=t(l)?l+"":l}if("string"!=typeof i)return 0===i?i:+i;i=e(i);var c=a.test(i);return c||s.test(i)?o(i.slice(2),c?2:8):n.test(i)?NaN:+i}}(),t=1/0;return re=function(r){return r?(r=e(r))===t||r===-1/0?17976931348623157e292*(r<0?-1:1):r==r?r:0:0===r?r:0}}function xe(){if(se)return ae;se=1;var e=function(){if(j)return p;j=1;var e=Math.ceil,t=Math.max;return p=function(r,n,a,s){for(var o=-1,i=t(e((n-r)/(a||1)),0),l=Array(i);i--;)l[s?i:++o]=r,r+=a;return l}}(),t=fe(),r=he();return ae=function(n){return function(a,s,o){return o&&"number"!=typeof o&&t(a,s,o)&&(s=o=void 0),a=r(a),void 0===s?(s=a,a=0):s=r(s),o=void 0===o?a<s?1:-1:r(o),e(a,s,o,n)}}}const pe=t(function(){if(ie)return oe;ie=1;var e=xe()();return oe=e}()),je=e=>(30*((e%2==0?2:e%2)-1)).toString().padStart(2,"0"),ye=({name:e,labelColor:t})=>s.jsxs("div",{className:"flex flex-row gap-1 items-center",children:[s.jsx("span",{className:o(t,"size-5 border rounded")}),s.jsx("span",{children:e})]}),ve=({floors:e,borrowedRooms:t,selectedRange:i,status:l})=>{const c=new Date(`${i.date} ${i.start_time}`).getHours(),u=new Date(`${i.date} ${i.end_time}`).getHours()+1,d="dark"===r(n),{user:m}=a();return s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex flex-row justify-end p-4 gap-4",children:[s.jsx(ye,{name:"Telah dibook",labelColor:"bg-yellow-300"}),s.jsx(ye,{name:"Disetujui",labelColor:"bg-green-300"})]}),s.jsx("div",{id:"table-container",className:o("overflow-auto scrollbar-hide",""),children:s.jsxs("table",{className:"table table-sm table-pin-rows table-pin-cols",children:[s.jsxs("thead",{className:"border",children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32",children:"Booking pada:"}),pe(c,u).map((e=>s.jsx("td",{className:"border border-l-4",colSpan:2,children:`${e}:00`},e)))]}),s.jsxs("tr",{className:"top-8 border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32",children:h(i.date,"dd MMM yyyy")}),pe(1,2*(u-c)+1).map((e=>{const t=(e-1)%2==0;return s.jsx("td",{className:o("border w-8 h-8",t?"border-l-4":""),children:je(e)},e)}))]})]}),s.jsx("tbody",{children:"success"===l?e.map((e=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o(d?"bg-transparent text-gray-300":"bg-neutral-700 text-white"),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),s.jsx("td",{className:o(d?"dark:bg-transparent":"bg-neutral-700"),colSpan:2*(24-c)})]}),e.rooms.sort(((e,t)=>e.name<t.name?-1:1)).map(((e,r)=>{let n=0;const a=r%2?d?"dark:bg-base-100":"bg-white":d?"dark:bg-base-300":"bg-gray-100";return s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o("border",a),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),pe(1,2*(u-c)+1).map((r=>{if(n>0)return n--,null;const l=((e,t)=>{const r=--t%2*30;return`${(e+Math.floor(t/2)).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:00`})(c,r);let u=o(d?"hover:bg-neutral-600":"hover:bg-gray-200",a);const f=(h=e.id,x=l,0!==(t??[]).length&&(t??[]).find((e=>{if(e.room?.id!==h)return!1;const t=e.start_borrowing_time+":00";if(t===x)return!0;const r=i.start_time+":00";return x===r&&t<r+":00"})));var h,x;let p=1;f&&(u=f.borrowed_status===b?"bg-yellow-300 hover:bg-yellow-500 transition-all":"bg-green-300 hover:bg-green-500 transition-all",d&&(u=o(u,"text-black font-semibold")),p=Math.ceil(((e,t)=>{const r=new Date(`1970-01-01T${e}Z`);return(new Date(`1970-01-01T${t}Z`).getTime()-r.getTime())/6e4})(l,f.end_event_time.toString())/30),"23:59:00"===f.end_event_time.toString()&&p++,n=p-1);const j=(r-1)%2==0;return s.jsx(we,{transactionDetailRoom:f,boldLeft:j,columnColor:u,colSpan:p,clickable:!!f&&(f.borrowed_by_user_id===m?.id||m?.role===g)},r)}))]},r)}))]},e.id))):s.jsx(Ne,{isDarkTheme:d,startHour:c})})]})})]})},we=({transactionDetailRoom:e,boldLeft:t,columnColor:r,colSpan:n,clickable:a})=>{const[l,c]=i.useState(!0),u=i.useRef(null);return i.useEffect((()=>{const e=()=>{const e=u.current?.closest("tr")?.querySelector("th")??null;if(e&&u.current){const t=e.getBoundingClientRect(),r=u.current.getBoundingClientRect().left-t.left;c(!(r<150))}},t=document.getElementById("table-container");return t?.addEventListener("scroll",e),()=>{t?.removeEventListener("scroll",e)}}),[]),s.jsx("td",{ref:u,onClick:()=>{if(!e)return;if(!a)return;const t="/room-request/"+e.id;window.open(t,"_blank")},className:o("border w-8 h-8 cursor-pointer -z-10",t?"border-l-4":"",r),colSpan:n,children:e&&s.jsxs("div",{className:o("group cursor-pointer",l?"relative":""),children:[s.jsx("div",{className:"truncate",style:{maxWidth:2*n+"rem"},children:e.event_name}),s.jsxs("span",{className:"absolute -top-14 left-1/2 -translate-x-1/2 scale-0 transition-transform duration-200 ease-out group-hover:scale-100 p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg flex flex-col min-w-32",children:[s.jsx("span",{children:`${e.start_borrowing_time} - ${e.end_event_time}`}),s.jsxs("span",{children:[e.pic_name," (",e.pic_phone_number,")"]})]})]})})},Ne=({isDarkTheme:e,startHour:t})=>s.jsx("tr",{className:"border",children:s.jsx("th",{className:o(e?"bg-transparent text-gray-300 border-b":"bg-neutral-700 text-white"),colSpan:2*(24-t)+1,children:s.jsxs("span",{className:"w-32 flex flex-row items-end gap-0.5",children:["Loading",s.jsx("span",{className:"loading loading-dots loading-xs"})]})})});class ke extends l{static async getRoomSchedules(){const{data:e}=await this._get("https://booking-api.parokipik.org/general/room-schedule");return e.floors}static async getSchedules(e){try{const{data:t}=await this._get("https://booking-api.parokipik.org/general/schedule",e);return t.borrowedRooms}catch(t){throw new Error(t.message)}}}const Se=()=>{const e=(()=>{const e=new Date;return e.getHours()>18&&e.setHours(18),e.setMinutes(0,0,0),e})(),[t,a]=i.useState([]),l="dark"===r(n),[b,g]=i.useState({date:h(e,"yyyy-MM-dd"),start_time:"00:00",end_time:"23:59"}),[p,j]=i.useState({date:h(e,"yyyy-MM-dd"),start_time:"00:00",end_time:"23:59"}),{data:y,status:v}=(()=>{const{data:e,status:t}=x({queryKey:["general/room-schedules"],queryFn:()=>ke.getRoomSchedules()});return{data:e,status:t}})(),{data:w,status:N}=(e=>{const{data:t,status:r}=x({queryKey:["general/schedule",e],queryFn:()=>ke.getSchedules(e),placeholderData:(e,t)=>e||void 0});return{data:t,status:r}})(p),k=e=>{const{date:t}=p,r=new Date(t);e(r);const n=h(r,"yyyy-MM-dd");g((e=>({...e,date:n}))),j((e=>({...e,date:n})))};return s.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4 mb-24",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[s.jsx(f,{pageName:"Jadwal"}),s.jsx("div",{className:"px-6 w-full flex justify-end",children:s.jsxs("div",{className:"join w-full sm:w-auto",children:[s.jsx("button",{onClick:()=>k((e=>e.setDate(e.getDate()+1))),className:o("btn join-item flex-1",l?"bg-neutral":"bg-white"),children:"Next Day"}),s.jsx("button",{onClick:()=>k((e=>e.setDate(e.getDate()+7))),className:o("btn join-item flex-1",l?"bg-neutral":"bg-white"),children:"Next Week"}),s.jsx("button",{onClick:()=>k((e=>e.setMonth(e.getMonth()+1))),className:o("btn join-item flex-1",l?"bg-neutral":"bg-white"),children:"Next Month"})]})})]}),s.jsxs("div",{className:"mx-6 flex flex-col md:flex-row items-end gap-4",children:[s.jsx(d,{type:"date",min:e.toISOString().split("T")[0],label:"Tanggal Booking",value:b.date,onChange:e=>{const t=e.target.value;g((e=>({...e,date:t})))}}),s.jsx("button",{className:"btn btn-primary w-full md:w-auto",type:"button",onClick:()=>{const e=new Date(`${b.date} ${b.start_time}`).getHours(),t=new Date(`${b.date} ${b.end_time}`).getHours();if(t<e)a([{message:"Jam Akhir Booking tidak boleh kurang dari Jam Awal Booking!"}]);else if(t-e<1)a([{message:"Jam Akhir Booking harus memiliki jarak minimal 1 jam dari Jam Awal Booking!"}]);else{if(t-e<6){let r=e,n=t;const a=Math.floor((e+t)/2);e<=6?(r=0,n=6):e>=18?(r=18,n=23):(r=Math.max(0,a-Math.floor(3)),n=Math.min(23,r+6));const s={...b,start_time:c.padStart(r.toString(),2,"0")+":00",end_time:c.padStart(n.toString(),2,"0")+":00"};g(s),j(s)}else j(b);a([])}},children:"Cari"})]}),s.jsx(m,{notification:t}),s.jsx("div",{className:"mx-6",children:s.jsx(ve,{floors:y,borrowedRooms:w,selectedRange:p,status:u(N,v)})})]})};export{Se as default};
