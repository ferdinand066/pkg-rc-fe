import{B as e,d as t,f as a,h as r,r as s,Q as n,i as o,k as i,j as l}from"./index-DuxHCDsN.js";import{P as c}from"./PageHeader-Dvh_HQ7V.js";import{D as m}from"./DialogButton-C4s9PfvH.js";import{T as u,P as d}from"./Table-DCN0X5ko.js";import{u as h}from"./use-item-BbtDPJ2b.js";import{u as f,I as p}from"./InputText-ZWl9SnFl.js";import"./useQuery-G1tKG1h3.js";const g="https://booking-api.parokipik.org/admin/item";class b extends e{static async createItem(e){try{return await this._post(`${g}`,e)}catch(t){throw new Error(t.message)}}static async updateItem(e,t){if(!e)return null;try{return await this._patch(`${g}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteItem(e){if(e)try{return await this._delete(`${g}/${e}`,{})}catch(t){throw new Error(t.message)}}}const x=s.forwardRef((({selectedItem:e},c)=>{const[m,u]=s.useState(e);s.useEffect((()=>{if(!e)return void u(void 0);const t={...e};u(t)}),[e]);const{register:d,setValue:h,errors:g,handleManageItem:x,handleDeleteItem:j,handleSubmit:y}=((e=null)=>{const{register:l,setValue:c,formState:{errors:m},handleSubmit:u,watch:d,reset:h}=f(),[p,g]=t(a),x=r();return s.useEffect((()=>{h(),e&&Object.keys(e).forEach((t=>{c(t,e[t])}))}),[e,c]),{register:l,setValue:c,errors:m,handleManageItem:async function(t){if(!p){g(!0);try{e?await n.promise(b.updateItem(e.id,t),{pending:"Waiting for update item!",error:i(),success:o()}):await n.promise(b.createItem(t),{pending:"Waiting for create item!",error:i(),success:o()})}catch(a){}x.invalidateQueries({queryKey:["general/item"]}),null!==e&&x.invalidateQueries({queryKey:["general/item",e.id]}),h(),g(!1)}},handleDeleteItem:async function(){if(e&&!p){g(!0);try{await n.promise(b.deleteItem(e.id),{pending:"Waiting for delete item!",error:i(),success:o()})}catch(t){}g(!1),h(),x.invalidateQueries({queryKey:["general/item"]})}},handleSubmit:u,watch:d}})(m);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Barang":"Buat Barang"}),l.jsxs("form",{onSubmit:y(x),className:"flex flex-col gap-2",children:[l.jsx(p,{label:"Nama Barang",type:"text",name:"name",register:d("name",{required:"Nama barang harus diisi"}),setValue:h,placeholder:"Cth: Speaker Portable",errors:g}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>c.current?.close(),children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",onClick:()=>c.current?.close(),children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>(await j(),c.current?.close()),children:"Hapus"})]})]})]})})),j=[{name:"name",sortable:!0},{name:"room_at",sortable:!1}],y=()=>{const[e,t]=s.useState({page:1}),[a,r]=s.useState({order_by:"name",data_order:"asc"}),{data:n,status:o}=h(e,a,!0),i=n,f=i?.data.map((e=>{const t={...e,room_at:(e.room_items??[]).map((e=>e.room?.name)).filter(Boolean).join(", ")};return{...t,room_at:t.room_at?t.room_at:"-",onClick:()=>{g(t),b.current?.showModal()}}})),[p,g]=s.useState(),b=s.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(c,{pageName:"Barang",action:l.jsx(m,{buttonValue:"Tambah Barang",onClick:()=>g(void 0),ref:b,children:l.jsx(x,{selectedItem:p,ref:b})})}),l.jsx(u,{header:j,data:f??[],status:o,sortData:a,setSortData:r,enableSort:!0}),l.jsx(d,{status:o,data:i,page:e.page,setPage:t})]})};export{y as default};
