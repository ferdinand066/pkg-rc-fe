import{S as t,D as e,E as s,G as a,H as i,a as r,r as n,B as o,j as u,Q as m}from"./index-CFS_nyTF.js";import{P as l}from"./page-header-Btf49FBv.js";import{D as d}from"./dialog-button-DBpGC11_.js";import{P as c}from"./pagination-BE6evns3.js";import{T as h}from"./table-BJTWHYZs.js";import{n as p,s as b,u as y}from"./useQuery-CRtEa33p.js";import{u as g,I as f}from"./input-text-B4o_KP5K.js";import{I as x}from"./input-select-CbbPI8yP.js";import{u as j}from"./use-room-C25zFEOY.js";import{u as _}from"./use-item-DDUtuC40.js";import"./isValid-5aXsojdQ.js";var v=class extends t{#t;#e=void 0;#s;#a;constructor(t,e){super(),this.#t=t,this.setOptions(e),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const a=this.options;this.options=this.#t.defaultMutationOptions(t),e(this.options,a)||this.#t.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#s,observer:this}),a?.mutationKey&&this.options.mutationKey&&s(a.mutationKey)!==s(this.options.mutationKey)?this.reset():"pending"===this.#s?.state.status&&this.#s.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#s?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#r(t)}getCurrentResult(){return this.#e}reset(){this.#s?.removeObserver(this),this.#s=void 0,this.#i(),this.#r()}mutate(t,e){return this.#a=e,this.#s?.removeObserver(this),this.#s=this.#t.getMutationCache().build(this.#t,this.options),this.#s.addObserver(this),this.#s.execute(t)}#i(){const t=this.#s?.state??a();this.#e={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#r(t){i.batch((()=>{if(this.#a&&this.hasListeners()){const e=this.#e.variables,s=this.#e.context;"success"===t?.type?(this.#a.onSuccess?.(t.data,e,s),this.#a.onSettled?.(t.data,null,e,s)):"error"===t?.type&&(this.#a.onError?.(t.error,e,s),this.#a.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach((t=>{t(this.#e)}))}))}};const M="https://booking-api.parokipik.org/admin/item-history";class O extends o{static async getItemHistories(t){const e=await this._get(`${M}`,t);return e?.data?.itemHistories}static async createItemHistory(t){return await this._post(`${M}`,t)}}const S=[{id:"added",name:"Penambahan Barang"},{id:"removed",name:"Pengurangan Barang"}],q=n.forwardRef(((t,e)=>{const s=r(),{data:a,status:o}=j({},{order_by:"name",data_order:"asc"},!1),{data:l,status:d}=_({},{order_by:"name",data_order:"asc"},!1),{register:c,setValue:h,formState:{errors:y},handleSubmit:M,reset:q}=g({defaultValues:{room_id:t.room?.id?.toString()??"",item_id:t.item?.id?.toString()??"",type:t.type??"added",quantity:t.quantity??1}}),R=function(t,e){const s=r(),[a]=n.useState((()=>new v(s,t)));n.useEffect((()=>{a.setOptions(t)}),[a,t]);const o=n.useSyncExternalStore(n.useCallback((t=>a.subscribe(i.batchCalls(t))),[a]),(()=>a.getCurrentResult()),(()=>a.getCurrentResult())),u=n.useCallback(((t,e)=>{a.mutate(t,e).catch(p)}),[a]);if(o.error&&b(a.options.throwOnError,[o.error]))throw o.error;return{...o,mutate:u,mutateAsync:o.mutate}}({mutationFn:t=>O.createItemHistory({room_id:t.room_id||null,item_id:t.item_id,type:t.type,quantity:Number(t.quantity)}),onSuccess:()=>{s.invalidateQueries({queryKey:["admin/item-history"]}),m.success("Transaksi berhasil ditambahkan."),q(),e.current?.close()},onError:()=>{m.error("Gagal menambah transaksi.")}}),k=M((t=>{R.mutate(t)})),T=a??[],C=l??[];return u.jsxs(u.Fragment,{children:[u.jsx("h3",{className:"font-bold text-lg",children:"Tambah Transaksi"}),u.jsxs("form",{onSubmit:k,className:"flex flex-col gap-2",children:["success"===o?u.jsx(x,{label:"Ruangan",name:"room_id",register:c("room_id"),setValue:h,model:T,errors:y,emptyOption:{value:"",label:"Barang Idle"}}):null,"success"===d?u.jsx(x,{label:"Barang",name:"item_id",register:c("item_id",{required:"Barang harus diisi"}),setValue:h,model:C,errors:y}):null,u.jsx(x,{label:"Tipe",name:"type",register:c("type",{required:"Tipe harus diisi"}),setValue:h,model:[...S],errors:y}),u.jsx(f,{label:"Jumlah",type:"number",name:"quantity",register:c("quantity",{required:"Jumlah harus diisi",min:{value:1,message:"Jumlah minimal 1"}}),setValue:h,min:1,errors:y}),u.jsxs("div",{className:"modal-action flex justify-end",children:[u.jsx("button",{className:"btn",type:"button",onClick:()=>e.current?.close(),children:"Tutup"}),u.jsx("button",{className:"btn btn-primary",type:"submit",disabled:R.isPending,children:R.isPending?"Loading...":"Tambah"})]})]})]})}));q.displayName="AddTransactionModal";const R=[{name:"item_name",sortable:!0},{name:"type",sortable:!0},{name:"room_name",sortable:!1},{name:"quantity",sortable:!0},{name:"user_name",sortable:!1}],k=()=>{const[t,e]=n.useState({page:1}),[s,a]=n.useState({order_by:"item_name",data_order:"asc"}),i=n.useRef(null),{data:r,status:o}=((t,e)=>{const{data:s,status:a}=y({queryKey:["admin/item-history",t,e],queryFn:()=>O.getItemHistories({...t,...e})});return{data:s,status:a}})(t,s),m=r?.data?.map((t=>({item_name:t.item?.name??"-",type:S.find((e=>e.id===t.type))?.name??t.type??"-",room_name:t.room?.name??"Idle item",quantity:t.quantity,user_name:t.user?.name??"-"})))??[];return u.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[u.jsx(l,{pageName:"Transaksi Barang",action:u.jsx(d,{buttonValue:"Tambah Transaksi",onClick:()=>{},ref:i,children:u.jsx(q,{ref:i})})}),u.jsx(h,{header:R,data:m,status:o,sortData:s,setSortData:a,enableSort:!0}),u.jsx(c,{status:o,data:r,page:t.page,setPage:e})]})};export{k as default};
