import{B as e,c as t,f as a,h as r,r as s,Q as n,i,k as o,j as l}from"./index-BRSyf36y.js";import{P as c}from"./PageHeader-BS1y_DYS.js";import{u,D as m}from"./use-item-BTTyS2Ht.js";import{T as d,P as h}from"./Table-CAswfOqN.js";import{u as f,I as p}from"./InputText-j-WValu1.js";import"./useQuery-CxiCfylb.js";const g="https://booking-api.reginacaeli.id/admin/item";class x extends e{static async createItem(e){try{return await this._post(`${g}`,e)}catch(t){throw new Error(t.message)}}static async updateItem(e,t){if(!e)return null;try{return await this._patch(`${g}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteItem(e){if(e)try{return await this._delete(`${g}/${e}`,{})}catch(t){throw new Error(t.message)}}}const b=s.forwardRef((({selectedItem:e},c)=>{const[u,m]=s.useState(e);s.useEffect((()=>{if(!e)return void m(void 0);const t={...e};m(t)}),[e]);const{register:d,setValue:h,errors:g,handleManageItem:b,handleDeleteItem:j,handleSubmit:y}=((e=null)=>{const{register:l,setValue:c,formState:{errors:u},handleSubmit:m,watch:d,reset:h}=f(),[p,g]=t(a),b=r();return s.useEffect((()=>{h(),e&&Object.keys(e).forEach((t=>{c(t,e[t])}))}),[e,c]),{register:l,setValue:c,errors:u,handleManageItem:async function(t){if(!p){g(!0);try{e?await n.promise(x.updateItem(e.id,t),{pending:"Waiting for update item!",error:i(),success:o()}):await n.promise(x.createItem(t),{pending:"Waiting for create item!",error:i(),success:o()})}catch(a){}b.invalidateQueries({queryKey:["general/item"]}),null!==e&&b.invalidateQueries({queryKey:["general/item",e.id]}),h(),g(!1)}},handleDeleteItem:async function(){if(e&&!p){g(!0);try{await n.promise(x.deleteItem(e.id),{pending:"Waiting for delete item!",error:i(),success:o()})}catch(t){}g(!1),h(),b.invalidateQueries({queryKey:["general/item"]})}},handleSubmit:m,watch:d}})(u);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Barang":"Buat Barang"}),l.jsxs("form",{onSubmit:y(b),className:"flex flex-col gap-2",children:[l.jsx(p,{label:"Nama Barang",type:"text",name:"name",register:d("name",{required:"Nama barang harus diisi"}),setValue:h,placeholder:"Cth: Speaker Portable",errors:g}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>{var e;return null==(e=c.current)?void 0:e.close()},children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",onClick:()=>{var e;return null==(e=c.current)?void 0:e.close()},children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>{var e;return await j(),null==(e=c.current)?void 0:e.close()},children:"Hapus"})]})]})]})})),j=["name","room_at"],y=()=>{const[e,t]=s.useState({page:1}),{data:a,status:r}=u(e,!0),n=a,i=null==n?void 0:n.data.map((e=>{const t={...e,room_at:(e.room_items??[]).map((e=>e.room.name)).join(", ")};return{...t,room_at:t.room_at?t.room_at:"-",onClick:()=>{var e;f(t),null==(e=p.current)||e.showModal()}}})),[o,f]=s.useState(),p=s.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(c,{pageName:"Barang",action:l.jsx(m,{buttonText:"Tambah Barang",onClick:()=>f(void 0),ref:p,children:l.jsx(b,{selectedItem:o,ref:p})})}),l.jsx(d,{header:j,data:i??[],status:r}),l.jsx(h,{status:r,data:n,page:e.page,setPage:t})]})};export{y as default};
