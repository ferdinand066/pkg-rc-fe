import{d as e,f as a,h as s,m as r,Q as i,i as t,k as n,r as l,j as m}from"./index-BMio7b_C.js";import{I as o}from"./InputSelect-BKT60kPV.js";import{u as d,I as u}from"./InputText-C-iQ4tFZ.js";import{I as c}from"./InputTextarea-_qbvJg5O.js";import{I as p}from"./InputToggle-BPG4zHPL.js";import{P as g}from"./PageHeader-oQ2FRQ3y.js";import{B as h,p as j,i as x,a as f}from"./borrowed-room-service-Dyfu059f.js";import{u as b}from"./use-room-CZ7BsnTR.js";import{I as _}from"./constants-5vXSpW5c.js";import{t as v}from"./isValid-5aXsojdQ.js";import{c as N}from"./constructFrom-BpBbSY1L.js";import{i as w}from"./isBefore-BU7b8VsE.js";import"./startOfDay-Cqt31xqJ.js";import"./useQuery-8fHC9d-I.js";function y(e,a){return function(e,a){const s=v(e);if(isNaN(a))return N(e,NaN);const r=s.getDate(),i=N(e,s.getTime());return i.setMonth(s.getMonth()+a+1,0),r>=i.getDate()?i:(s.setFullYear(i.getFullYear(),i.getMonth(),r),s)}(e,12*a)}const V=[{id:"daily",name:"Harian"},{id:"weekly",name:"Mingguan"},{id:"monthly",name:"Bulanan"}],q=()=>{const{data:v,status:N}=b({},{order_by:"name",data_order:"asc"},!1),{register:q,setValue:k,errors:I,handleManageBorrowedRoom:P,handleSubmit:S,watch:$,getValues:B}=(()=>{const{register:l,setValue:m,getValues:o,formState:{errors:u},handleSubmit:c,watch:p,reset:g,formState:j}=d(),[x,f]=e(a),b=s(),_=r();return{register:l,setValue:m,errors:u,handleManageBorrowedRoom:async function(e){if(!x){e={...e,items:e.items.filter((e=>!!e.item_id))},f(!0);try{await i.promise(h.createRecurringBorrowedRoom(e),{pending:"Waiting for create borrowed room!",error:n(),success:t()})}catch{}b.invalidateQueries({queryKey:["general/borrowed-room"]}),f(!1),g(),_("/room-request")}},handleSubmit:c,watch:p,getValues:o,formState:j}})(),D=$("room_id"),[J,M]=l.useState(!1);return l.useEffect((()=>{if("success"!==N)return;if(J)return;M(!0);k("room_id",v[0].id)}),[J,N]),m.jsx("section",{className:"flex flex-col h-full flex-1 gap-4 mb-8 divide-y",children:m.jsxs("div",{className:"flex flex-col",children:[m.jsx(g,{pageName:"Buat Proposal Pinjam Ruang Berulang"}),m.jsxs("form",{onSubmit:S(P),className:"grid grid-cols-6 gap-4 mx-6",children:[m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(u,{label:"Nama Kegiatan",type:"text",name:"event_name",placeholder:"Contoh: Acara Natal",register:q("event_name",{required:"Nama kegiatan harus diisi"}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(o,{label:"Berulang Setiap",name:"recurring",register:q("recurring",{required:"Jangka berulang harus diisi"}),setValue:k,model:V.map((e=>({id:e.id,name:e.name}))),errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(u,{label:"Nama PIC",type:"text",name:"pic_name",placeholder:"Tuliskan nama anda",register:q("pic_name",{required:"Nama PIC harus diisi"}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(u,{label:"No. Telp PIC",type:"text",name:"pic_phone_number",placeholder:"Format: 08.....",register:q("pic_phone_number",{required:"No. Telp PIC harus diisi"}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(u,{label:"Mulai Pinjam",type:"date",name:"start_borrowed_date",register:q("start_borrowed_date",{required:"Tanggal mulai harus diisi",validate:e=>{const a=j(e),s=new Date;return!(!x(a,s)&&!f(a,s))||"Tanggal peminjaman awal harus setelah hari ini"}}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(u,{label:"Selesai Pinjam",type:"date",name:"end_borrowed_date",register:q("end_borrowed_date",{required:"Tanggal peminjaman akhir harus diisi",validate:e=>{const a=j(e),s=new Date;if(!x(a,s)&&!f(a,s))return"Tanggal peminjaman akhir harus setelah hari ini";const r=B("start_borrowed_date");if(w(a,r))return"Tanggal peminjaman akhir harus setelah tanggal mulai peminjaman";const i=y(j(r),1);return!x(a,i)||"Tanggal peminjaman akhir maksimal 1 tahun setelah tanggal mulai peminjaman"}}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Kapasitas",type:"number",name:"capacity",register:q("capacity",{required:"Kapasitas harus diisi"}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(o,{label:"Ruangan",name:"room_id",register:q("room_id",{required:"Ruangan harus diisi"}),setValue:k,model:(v??[]).map((e=>({id:e.id,name:e.name+" ("+e.floor.name+")"})))??[],errors:I,isLoading:"pending"===N})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Mulai Pinjam",type:"time",step:_,name:"start_borrowing_time",register:q("start_borrowing_time",{required:"Jam mulai pinjam harus diisi"}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Mulai Acara",type:"time",step:_,name:"start_event_time",register:q("start_event_time",{required:"Jam mulai acara harus diisi",validate:e=>{const a=B("start_borrowing_time"),s=new Date(`2000-01-01T${a}`);if(w(new Date(`2000-01-01T${e}`),s))return"Jam mulai harus setelah jam mulai pinjam"}}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Selesai Pinjam",type:"time",step:_,name:"end_event_time",register:q("end_event_time",{required:"Jam akhir harus diisi",validate:e=>{const a=B("start_event_time"),s=new Date(`2000-01-01T${a}`);if(!x(new Date(`2000-01-01T${e}`),s))return"Jam akhir event harus setelah jam mulai event"}}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:"pending"===N?m.jsx(T,{}):D&&v&&v.find((e=>e.id===D))?.room_items?.map(((e,a)=>{const s=$(`items.${a}.item_id`);return m.jsxs("div",{className:"grid grid-cols-3 items-center",children:[m.jsx(p,{label:e.item.name,name:`items.${a}.item_id`,id:`items.${a}.item_id`,value:e.item_id,register:q(`items.${a}.item_id`),inputContainerClassName:"col-span-2",errors:I}),!!s&&m.jsx(u,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${a}.quantity`,id:`items.${a}.quantity`,register:q(`items.${a}.quantity`,{required:"Harus diisi"}),setValue:k,errors:I})]},e.id)}))}),m.jsx("div",{className:"col-span-6",children:m.jsx(c,{label:"Keterangan",name:"description",id:"description",register:q("description",{required:"Keterangan harus diisi"}),setValue:k,errors:I})}),m.jsx("div",{className:"col-span-6 modal-action flex-row-reverse justify-between",children:m.jsxs("div",{className:"flex flex-row gap-4",children:[m.jsx("button",{className:"btn btn-neutral",type:"button",children:"Tutup"}),m.jsx("button",{className:"btn btn-primary",type:"submit",children:"Buat"})]})})]})]})})},T=()=>m.jsxs("div",{className:"flex flex-row gap-4 px-1 items-center",children:[m.jsx("div",{className:"bg-base-300 min-w-12 animate-pulse rounded-full h-7"}),m.jsx("div",{className:"bg-base-300 min-w-32 animate-pulse rounded-full h-6"})]});export{q as default};
