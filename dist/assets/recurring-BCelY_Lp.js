import{c as e,f as a,h as s,m as r,Q as i,i as t,k as n,r as l,j as m}from"./index-CiWvO_dC.js";import{I as o}from"./InputSelect-DhIGKHTq.js";import{u as d,I as u}from"./InputText-DGXgaqni.js";import{I as c}from"./InputTextarea-C8ll2KdT.js";import{I as p}from"./InputToggle-B0C-rogJ.js";import{P as g}from"./PageHeader-HkiibMAb.js";import{B as h,p as j,i as x,a as b}from"./borrowed-room-service-DTvy3s9D.js";import{u as _}from"./use-room-DTT0JR26.js";import{I as f}from"./constants-5vXSpW5c.js";import{i as v}from"./isBefore-BU7b8VsE.js";import"./startOfDay-Cqt31xqJ.js";import"./isValid-5aXsojdQ.js";import"./useQuery-FuiwIscj.js";const N=[{id:"daily",name:"Harian"},{id:"weekly",name:"Mingguan"},{id:"monthly",name:"Bulanan"}],w=()=>{var w,V;const{data:q,status:T}=_({},{order_by:"name",data_order:"asc"},!1),{register:I,setValue:P,errors:S,handleManageBorrowedRoom:k,handleSubmit:$,watch:B,getValues:J}=(()=>{const{register:l,setValue:m,getValues:o,formState:{errors:u},handleSubmit:c,watch:p,reset:g,formState:j}=d(),[x,b]=e(a),_=s(),f=r();return{register:l,setValue:m,errors:u,handleManageBorrowedRoom:async function(e){if(!x){e={...e,items:e.items.filter((e=>!!e.item_id))},b(!0);try{await i.promise(h.createRecurringBorrowedRoom(e),{pending:"Waiting for create borrowed room!",error:t(),success:n()})}catch{}_.invalidateQueries({queryKey:["general/borrowed-room"]}),b(!1),g(),f("/room-request")}},handleSubmit:c,watch:p,getValues:o,formState:j}})(),C=B("room_id"),[D,R]=l.useState(!1);return l.useEffect((()=>{if("success"!==T)return;if(D)return;R(!0);P("room_id",q[0].id)}),[D,T]),m.jsx("section",{className:"flex flex-col h-full flex-1 gap-4 mb-8 divide-y",children:m.jsxs("div",{className:"flex flex-col",children:[m.jsx(g,{pageName:"Buat Proposal Pinjam Ruang Berulang"}),m.jsxs("form",{onSubmit:$(k),className:"grid grid-cols-6 gap-4 mx-6",children:[m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(u,{label:"Nama Kegiatan",type:"text",name:"event_name",placeholder:"Contoh: Acara Natal",register:I("event_name",{required:"Nama kegiatan harus diisi"}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(o,{label:"Berulang Setiap",name:"recurring",register:I("recurring",{required:"Jangka berulang harus diisi"}),setValue:P,model:N.map((e=>({id:e.id,name:e.name}))),errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(u,{label:"Nama PIC",type:"text",name:"pic_name",placeholder:"Tuliskan nama anda",register:I("pic_name",{required:"Nama PIC harus diisi"}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(u,{label:"No. Telp PIC",type:"text",name:"pic_phone_number",placeholder:"Format: 08.....",register:I("pic_phone_number",{required:"No. Telp PIC harus diisi"}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(u,{label:"Mulai Pinjam",type:"date",name:"start_borrowed_date",register:I("start_borrowed_date",{required:"Tanggal mulai harus diisi",validate:e=>{const a=j(e),s=new Date;return!(!x(a,s)&&!b(a,s))||"Tanggal peminjaman awal harus setelah hari ini"}}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(u,{label:"Selesai Pinjam",type:"date",name:"end_borrowed_date",register:I("end_borrowed_date",{required:"Tanggal peminjaman akhir harus diisi",validate:e=>{const a=j(e),s=new Date;if(!x(a,s)&&!b(a,s))return"Tanggal peminjaman akhir harus setelah hari ini";const r=J("start_borrowed_date");return!v(a,r)||"Tanggal peminjaman akhir harus setelah tanggal mulai peminjaman"}}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Kapasitas",type:"number",name:"capacity",register:I("capacity",{required:"Kapasitas harus diisi"}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(o,{label:"Ruangan",name:"room_id",register:I("room_id",{required:"Ruangan harus diisi"}),setValue:P,model:(q??[]).map((e=>({id:e.id,name:e.name+" ("+e.floor.name+")"})))??[],errors:S,isLoading:"pending"===T})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Mulai Pinjam",type:"time",step:f,name:"start_borrowing_time",register:I("start_borrowing_time",{required:"Jam mulai pinjam harus diisi"}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Mulai Acara",type:"time",step:f,name:"start_event_time",register:I("start_event_time",{required:"Jam mulai acara harus diisi",validate:e=>{const a=J("start_borrowing_time"),s=new Date(`2000-01-01T${a}`);if(v(new Date(`2000-01-01T${e}`),s))return"Jam mulai harus setelah jam mulai pinjam"}}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Selesai Pinjam",type:"time",step:f,name:"end_event_time",register:I("end_event_time",{required:"Jam akhir harus diisi",validate:e=>{const a=J("start_event_time"),s=new Date(`2000-01-01T${a}`);if(!x(new Date(`2000-01-01T${e}`),s))return"Jam akhir event harus setelah jam mulai event"}}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:"pending"===T?m.jsx(y,{}):C&&q&&(null==(V=null==(w=q.find((e=>e.id===C)))?void 0:w.room_items)?void 0:V.map(((e,a)=>{const s=B(`items.${a}.item_id`);return m.jsxs("div",{className:"grid grid-cols-3 items-center",children:[m.jsx(p,{label:e.item.name,name:`items.${a}.item_id`,id:`items.${a}.item_id`,value:e.item_id,register:I(`items.${a}.item_id`),inputContainerClassName:"col-span-2",errors:S}),!!s&&m.jsx(u,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${a}.quantity`,id:`items.${a}.quantity`,register:I(`items.${a}.quantity`,{required:"Harus diisi"}),setValue:P,errors:S})]},e.id)})))}),m.jsx("div",{className:"col-span-6",children:m.jsx(c,{label:"Keterangan",name:"description",id:"description",register:I("description",{required:"Keterangan harus diisi"}),setValue:P,errors:S})}),m.jsx("div",{className:"col-span-6 modal-action flex-row-reverse justify-between",children:m.jsxs("div",{className:"flex flex-row gap-4",children:[m.jsx("button",{className:"btn btn-neutral",type:"button",children:"Tutup"}),m.jsx("button",{className:"btn btn-primary",type:"submit",children:"Buat"})]})})]})]})})},y=()=>m.jsxs("div",{className:"flex flex-row gap-4 px-1 items-center",children:[m.jsx("div",{className:"bg-base-300 min-w-12 animate-pulse rounded-full h-7"}),m.jsx("div",{className:"bg-base-300 min-w-32 animate-pulse rounded-full h-6"})]});export{w as default};
