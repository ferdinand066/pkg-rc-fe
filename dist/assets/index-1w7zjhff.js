import{B as e,c as a,f as t,h as s,r,Q as i,i as o,k as n,j as l}from"./index-Q29Gw3BZ.js";import{P as m}from"./PageHeader-B06INfxG.js";import{D as u}from"./DialogButton-6GGsKb09.js";import{T as d,P as c}from"./Table-Dp0kSu-6.js";import{u as p}from"./use-room-B7NK_RzJ.js";import{I as f}from"./InputSelect-DIBZSJPl.js";import{u as g,I as h}from"./InputText-CfVcbHue.js";import{I as j}from"./InputToggle-VOBdqH88.js";import{u as y}from"./use-floor-DpeGvi-p.js";import{u as b}from"./use-item-CqDpfpr4.js";import"./useQuery-C2YiQuKN.js";import"./isValid-5aXsojdQ.js";const x="https://booking-api.reginacaeli.id/admin/room";class v extends e{static async createRoom(e){try{return await this._post(`${x}`,e)}catch(a){throw new Error(a.message)}}static async updateRoom(e,a){if(!e)return null;try{return await this._patch(`${x}/${e}`,a)}catch(t){throw new Error(t.message)}}static async deleteRoom(e){if(e)try{return await this._delete(`${x}/${e}`,{})}catch(a){throw new Error(a.message)}}}const _=r.forwardRef((({selectedRoom:e},m)=>{const{data:u,status:d}=y({order_by:"created_at",data_order:"asc"}),{data:c,status:p}=b({},{order_by:"name",data_order:"asc"},!1),[x,_]=r.useState(e),w=c;r.useEffect((()=>{if("success"!==p)return;if(!e)return void _(void 0);const a=new Map;null==w||w.forEach(((e,t)=>a.set(e.id,t)));const t=new Array((null==w?void 0:w.length)??0);for(const r of(null==e?void 0:e.item_id)??[]){const e=a.get(r);void 0!==e&&(t[e]=r)}const s={...e,item_id:t};_(s)}),[p,e]);const{register:R,setValue:N,errors:$,handleManageRoom:q,handleDeleteRoom:S,handleSubmit:V,watch:C}=((e=null)=>{const{register:l,setValue:m,getValues:u,formState:{errors:d},handleSubmit:c,watch:p,reset:f}=g(),[h,j]=a(t),y=s();return r.useEffect((()=>{var a;f(),e&&(Object.keys(e).filter((e=>!["room_items","item_id"].includes(e))).forEach((a=>{m(a,e[a])})),null==(a=e.room_items)||a.map((a=>{var t;const s=null==(t=e.item_id)?void 0:t.indexOf(a.item_id);void 0!==s&&(s<0||(m(`items.${s}.item_id`,a.item_id),m(`items.${s}.quantity`,a.quantity)))})))}),[e,m]),{register:l,setValue:m,getValues:u,errors:d,handleManageRoom:async function(a){if(!h){a={...a,items:a.items.filter((e=>!!e.item_id))},j(!0);try{e?await i.promise(v.updateRoom(e.id,a),{pending:"Waiting for update room!",error:o(),success:n()}):await i.promise(v.createRoom(a),{pending:"Waiting for create room!",error:o(),success:n()})}catch(t){}y.invalidateQueries({queryKey:["general/room"]}),null!==e&&y.invalidateQueries({queryKey:["general/room",e.id]}),f(),j(!1)}},handleDeleteRoom:async function(){if(e&&!h){j(!0);try{await i.promise(v.deleteRoom(e.id),{pending:"Waiting for delete room!",error:o(),success:n()})}catch(a){}j(!1),f(),y.invalidateQueries({queryKey:["general/room"]})}},handleSubmit:c,watch:p}})(x);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Ruangan":"Buat Ruangan"}),l.jsxs("form",{onSubmit:V((async e=>{var a;await q(e),null==(a=m.current)||a.close()})),className:"flex flex-col gap-2",children:[l.jsx(h,{label:"Nama Ruangan",type:"text",name:"name",register:R("name",{required:"Nama ruangan harus diisi"}),setValue:N,placeholder:"Cth: Bartolomeus",errors:$}),"success"===d?l.jsx(f,{label:"Lantai",name:"floor_id",register:R("floor_id",{required:"Lantai harus diisi"}),setValue:N,model:u??[],errors:$}):l.jsx(l.Fragment,{}),l.jsx(h,{label:"Kapasitas",type:"number",name:"capacity",register:R("capacity",{required:"Kapasitas harus diisi"}),min:1,setValue:N,errors:$}),l.jsx("span",{}),"success"===p?null==w?void 0:w.map(((e,a)=>{const t=C(`items.${a}.item_id`);return l.jsxs("div",{className:"grid grid-cols-3 items-center",children:[l.jsx(j,{label:e.name,name:`items.${a}.item_id`,id:`items.${a}.item_i d`,value:e.id,register:R(`items.${a}.item_id`),inputContainerClassName:"col-span-2",errors:$}),!!t&&l.jsx(h,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${a}.quantity`,id:`items.${a}.quantity`,register:R(`items.${a}.quantity`,{required:"Harus diisi"}),errors:$})]},e.id)})):l.jsx(l.Fragment,{}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>{var e;return null==(e=m.current)?void 0:e.close()},children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>{var e;return await S(),null==(e=m.current)?void 0:e.close()},children:"Hapus"})]})]})]})})),w=[{name:"name",sortable:!0},{name:"floor_name",sortable:!0},{name:"items",sortable:!1}],R=()=>{const[e,a]=r.useState({page:1}),[t,s]=r.useState({order_by:"name",data_order:"asc"}),{data:i,status:o}=p(e,t,!0),n=i,f=null==n?void 0:n.data.map((e=>{var a,t;const s={...e,floor_name:e.floor.name,items:null==(a=null==e?void 0:e.room_items)?void 0:a.map((e=>e.item.name)).join(", "),item_id:null==(t=null==e?void 0:e.room_items)?void 0:t.map((e=>e.item_id))};return{...s,items:s.items?s.items:"-",onClick:()=>{var e;h(s),null==(e=j.current)||e.showModal()}}})),[g,h]=r.useState(),j=r.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(m,{pageName:"Ruangan",action:l.jsx(u,{buttonValue:"Tambah Ruangan",onClick:()=>h(void 0),ref:j,children:l.jsx(_,{selectedRoom:g,ref:j})})}),l.jsx(d,{header:w,data:f??[],status:o,sortData:t,setSortData:s,enableSort:!0}),l.jsx(c,{status:o,data:n,page:e.page,setPage:a})]})};export{R as default};
