import{B as e,c as t,f as a,h as s,r,Q as i,i as o,k as n,j as l}from"./index-CiWvO_dC.js";import{P as m}from"./PageHeader-HkiibMAb.js";import{D as u}from"./DialogButton-Cz3Hy9Dy.js";import{T as d,P as c}from"./Table-FM-TymyM.js";import{u as p}from"./use-room-DTT0JR26.js";import{I as f}from"./InputSelect-DhIGKHTq.js";import{u as g,I as h}from"./InputText-DGXgaqni.js";import{I as j}from"./InputToggle-B0C-rogJ.js";import{u as y}from"./use-floor-C_tGvpZK.js";import{u as b}from"./use-item-BXANlQNe.js";import"./useQuery-FuiwIscj.js";import"./isValid-5aXsojdQ.js";const x="https://booking-api.parokipik.org/admin/room";class v extends e{static async createRoom(e){try{return await this._post(`${x}`,e)}catch(t){throw new Error(t.message)}}static async updateRoom(e,t){if(!e)return null;try{return await this._patch(`${x}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteRoom(e){if(e)try{return await this._delete(`${x}/${e}`,{})}catch(t){throw new Error(t.message)}}}const _=r.forwardRef((({selectedRoom:e},m)=>{const{data:u,status:d}=y({order_by:"created_at",data_order:"asc"}),{data:c,status:p}=b({},{order_by:"name",data_order:"asc"},!1),[x,_]=r.useState(e),w=c;r.useEffect((()=>{if("success"!==p)return;if(!e)return void _(void 0);const t=new Map;null==w||w.forEach(((e,a)=>t.set(e.id,a)));const a=new Array((null==w?void 0:w.length)??0);for(const r of(null==e?void 0:e.item_id)??[]){const e=t.get(r);void 0!==e&&(a[e]=r)}const s={...e,item_id:a};_(s)}),[p,e]);const{register:R,setValue:N,errors:$,handleManageRoom:q,handleDeleteRoom:S,handleSubmit:V,watch:k}=((e=null)=>{const{register:l,setValue:m,getValues:u,formState:{errors:d},handleSubmit:c,watch:p,reset:f}=g(),[h,j]=t(a),y=s();return r.useEffect((()=>{var t;f(),e&&(Object.keys(e).filter((e=>!["room_items","item_id"].includes(e))).forEach((t=>{m(t,e[t])})),null==(t=e.room_items)||t.map((t=>{var a;const s=null==(a=e.item_id)?void 0:a.indexOf(t.item_id);void 0!==s&&(s<0||(m(`items.${s}.item_id`,t.item_id),m(`items.${s}.quantity`,t.quantity)))})))}),[e,m]),{register:l,setValue:m,getValues:u,errors:d,handleManageRoom:async function(t){if(!h){t={...t,items:t.items.filter((e=>!!e.item_id))},j(!0);try{e?await i.promise(v.updateRoom(e.id,t),{pending:"Waiting for update room!",error:o(),success:n()}):await i.promise(v.createRoom(t),{pending:"Waiting for create room!",error:o(),success:n()})}catch(a){}y.invalidateQueries({queryKey:["general/room"]}),null!==e&&y.invalidateQueries({queryKey:["general/room",e.id]}),f(),j(!1)}},handleDeleteRoom:async function(){if(e&&!h){j(!0);try{await i.promise(v.deleteRoom(e.id),{pending:"Waiting for delete room!",error:o(),success:n()})}catch(t){}j(!1),f(),y.invalidateQueries({queryKey:["general/room"]})}},handleSubmit:c,watch:p}})(x);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Ruangan":"Buat Ruangan"}),l.jsxs("form",{onSubmit:V((async e=>{var t;await q(e),null==(t=m.current)||t.close()})),className:"flex flex-col gap-2",children:[l.jsx(h,{label:"Nama Ruangan",type:"text",name:"name",register:R("name",{required:"Nama ruangan harus diisi"}),setValue:N,placeholder:"Cth: Bartolomeus",errors:$}),"success"===d?l.jsx(f,{label:"Lantai",name:"floor_id",register:R("floor_id",{required:"Lantai harus diisi"}),setValue:N,model:u??[],errors:$}):l.jsx(l.Fragment,{}),l.jsx(h,{label:"Kapasitas",type:"number",name:"capacity",register:R("capacity",{required:"Kapasitas harus diisi"}),min:1,setValue:N,errors:$}),l.jsx("span",{}),"success"===p?null==w?void 0:w.map(((e,t)=>{const a=k(`items.${t}.item_id`);return l.jsxs("div",{className:"grid grid-cols-3 items-center",children:[l.jsx(j,{label:e.name,name:`items.${t}.item_id`,id:`items.${t}.item_i d`,value:e.id,register:R(`items.${t}.item_id`),inputContainerClassName:"col-span-2",errors:$}),!!a&&l.jsx(h,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${t}.quantity`,id:`items.${t}.quantity`,register:R(`items.${t}.quantity`,{required:"Harus diisi"}),errors:$})]},e.id)})):l.jsx(l.Fragment,{}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>{var e;return null==(e=m.current)?void 0:e.close()},children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>{var e;return await S(),null==(e=m.current)?void 0:e.close()},children:"Hapus"})]})]})]})})),w=[{name:"name",sortable:!0},{name:"floor_name",sortable:!0},{name:"items",sortable:!1}],R=()=>{const[e,t]=r.useState({page:1}),[a,s]=r.useState({order_by:"name",data_order:"asc"}),{data:i,status:o}=p(e,a,!0),n=i,f=null==n?void 0:n.data.map((e=>{var t,a;const s={...e,floor_name:e.floor.name,items:null==(t=null==e?void 0:e.room_items)?void 0:t.map((e=>e.item.name)).join(", "),item_id:null==(a=null==e?void 0:e.room_items)?void 0:a.map((e=>e.item_id))};return{...s,items:s.items?s.items:"-",onClick:()=>{var e;h(s),null==(e=j.current)||e.showModal()}}})),[g,h]=r.useState(),j=r.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(m,{pageName:"Ruangan",action:l.jsx(u,{buttonValue:"Tambah Ruangan",onClick:()=>h(void 0),ref:j,children:l.jsx(_,{selectedRoom:g,ref:j})})}),l.jsx(d,{header:w,data:f??[],status:o,sortData:a,setSortData:s,enableSort:!0}),l.jsx(c,{status:o,data:n,page:e.page,setPage:t})]})};export{R as default};
