var t,e,s,i,r,n,a,h,o,l,c,u,d,p,f,v,y,b,w,R,O,g,k,m,C,S,W,M,E,U,F,T,P,Q=(t,e,s)=>{if(!e.has(t))throw TypeError("Cannot "+s)},D=(t,e,s)=>(Q(t,e,"read from private field"),s?s.call(t):e.get(t)),x=(t,e,s)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,s)},I=(t,e,s,i)=>(Q(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),L=(t,e,s)=>(Q(t,e,"access private method"),s);import{S as A,C as q,D as j,E as B,G as _,H as z,I as H,J as G,K as J,M as K,r as N,h as V}from"./index-BArCvGrE.js";var X=(P=class extends A{constructor(v,b){super(),x(this,f),x(this,y),x(this,w),x(this,O),x(this,k),x(this,C),x(this,W),x(this,E),x(this,F),x(this,t,void 0),x(this,e,void 0),x(this,s,void 0),x(this,i,void 0),x(this,r,void 0),x(this,n,void 0),x(this,a,void 0),x(this,h,void 0),x(this,o,void 0),x(this,l,void 0),x(this,c,void 0),x(this,u,void 0),x(this,d,void 0),x(this,p,new Set),this.options=b,I(this,t,v),I(this,a,null),this.bindMethods(),this.setOptions(b)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(D(this,e).addObserver(this),Y(D(this,e),this.options)?L(this,f,v).call(this):this.updateResult(),L(this,k,m).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Z(D(this,e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Z(D(this,e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,L(this,C,S).call(this),L(this,W,M).call(this),D(this,e).removeObserver(this)}setOptions(s,i){const r=this.options,n=D(this,e);if(this.options=D(this,t).defaultQueryOptions(s),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled)throw new Error("Expected enabled to be a boolean");L(this,E,U).call(this),D(this,e).setOptions(this.options),r._defaulted&&!q(this.options,r)&&D(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:D(this,e),observer:this});const a=this.hasListeners();a&&$(D(this,e),n,this.options,r)&&L(this,f,v).call(this),this.updateResult(i),!a||D(this,e)===n&&this.options.enabled===r.enabled&&this.options.staleTime===r.staleTime||L(this,y,b).call(this);const h=L(this,w,R).call(this);!a||D(this,e)===n&&this.options.enabled===r.enabled&&h===D(this,d)||L(this,O,g).call(this,h)}getOptimisticResult(s){const a=D(this,t).getQueryCache().build(D(this,t),s),h=this.createResult(a,s);return function(t,e){if(!q(t.getCurrentResult(),e))return!0;return!1}(this,h)&&(I(this,i,h),I(this,n,this.options),I(this,r,D(this,e).state)),h}getCurrentResult(){return D(this,i)}trackResult(t,e){const s={};return Object.keys(t).forEach((i=>{Object.defineProperty(s,i,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(i),null==e||e(i),t[i])})})),s}trackProp(t){D(this,p).add(t)}getCurrentQuery(){return D(this,e)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(e){const s=D(this,t).defaultQueryOptions(e),i=D(this,t).getQueryCache().build(D(this,t),s);return i.isFetchingOptimistic=!0,i.fetch().then((()=>this.createResult(i,s)))}fetch(t){return L(this,f,v).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then((()=>(this.updateResult(),D(this,i))))}createResult(t,c){var u;const d=D(this,e),p=this.options,f=D(this,i),v=D(this,r),y=D(this,n),b=t!==d?t.state:D(this,s),{state:w}=t;let R,O={...w},g=!1;if(c._optimisticResults){const e=this.hasListeners(),s=!e&&Y(t,c),i=e&&$(t,d,c,p);(s||i)&&(O={...O,...G(w.data,t.options)}),"isRestoring"===c._optimisticResults&&(O.fetchStatus="idle")}let{error:k,errorUpdatedAt:m,status:C}=O;if(c.select&&void 0!==O.data)if(f&&O.data===(null==v?void 0:v.data)&&c.select===D(this,h))R=D(this,o);else try{I(this,h,c.select),R=c.select(O.data),R=J(null==f?void 0:f.data,R,c),I(this,o,R),I(this,a,null)}catch(F){I(this,a,F)}else R=O.data;if(void 0!==c.placeholderData&&void 0===R&&"pending"===C){let t;if((null==f?void 0:f.isPlaceholderData)&&c.placeholderData===(null==y?void 0:y.placeholderData))t=f.data;else if(t="function"==typeof c.placeholderData?c.placeholderData(null==(u=D(this,l))?void 0:u.state.data,D(this,l)):c.placeholderData,c.select&&void 0!==t)try{t=c.select(t),I(this,a,null)}catch(F){I(this,a,F)}void 0!==t&&(C="success",R=J(null==f?void 0:f.data,t,c),g=!0)}D(this,a)&&(k=D(this,a),R=D(this,o),m=Date.now(),C="error");const S="fetching"===O.fetchStatus,W="pending"===C,M="error"===C,E=W&&S,U=void 0!==R;return{status:C,fetchStatus:O.fetchStatus,isPending:W,isSuccess:"success"===C,isError:M,isInitialLoading:E,isLoading:E,data:R,dataUpdatedAt:O.dataUpdatedAt,error:k,errorUpdatedAt:m,failureCount:O.fetchFailureCount,failureReason:O.fetchFailureReason,errorUpdateCount:O.errorUpdateCount,isFetched:O.dataUpdateCount>0||O.errorUpdateCount>0,isFetchedAfterMount:O.dataUpdateCount>b.dataUpdateCount||O.errorUpdateCount>b.errorUpdateCount,isFetching:S,isRefetching:S&&!W,isLoadingError:M&&!U,isPaused:"paused"===O.fetchStatus,isPlaceholderData:g,isRefetchError:M&&U,isStale:tt(t,c),refetch:this.refetch}}updateResult(t){const s=D(this,i),a=this.createResult(D(this,e),this.options);if(I(this,r,D(this,e).state),I(this,n,this.options),void 0!==D(this,r).data&&I(this,l,D(this,e)),q(a,s))return;I(this,i,a);const h={};!1!==(null==t?void 0:t.listeners)&&(()=>{if(!s)return!0;const{notifyOnChangeProps:t}=this.options,e="function"==typeof t?t():t;if("all"===e||!e&&!D(this,p).size)return!0;const r=new Set(e??D(this,p));return this.options.throwOnError&&r.add("error"),Object.keys(D(this,i)).some((t=>{const e=t;return D(this,i)[e]!==s[e]&&r.has(e)}))})()&&(h.listeners=!0),L(this,F,T).call(this,{...h,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&L(this,k,m).call(this)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,n=new WeakMap,a=new WeakMap,h=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakSet,v=function(t){L(this,E,U).call(this);let s=D(this,e).fetch(this.options,t);return(null==t?void 0:t.throwOnError)||(s=s.catch(j)),s},y=new WeakSet,b=function(){if(L(this,C,S).call(this),B||D(this,i).isStale||!_(this.options.staleTime))return;const t=z(D(this,i).dataUpdatedAt,this.options.staleTime);I(this,c,setTimeout((()=>{D(this,i).isStale||this.updateResult()}),t+1))},w=new WeakSet,R=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(D(this,e)):this.options.refetchInterval)??!1},O=new WeakSet,g=function(t){L(this,W,M).call(this),I(this,d,t),!B&&!1!==this.options.enabled&&_(D(this,d))&&0!==D(this,d)&&I(this,u,setInterval((()=>{(this.options.refetchIntervalInBackground||H.isFocused())&&L(this,f,v).call(this)}),D(this,d)))},k=new WeakSet,m=function(){L(this,y,b).call(this),L(this,O,g).call(this,L(this,w,R).call(this))},C=new WeakSet,S=function(){D(this,c)&&(clearTimeout(D(this,c)),I(this,c,void 0))},W=new WeakSet,M=function(){D(this,u)&&(clearInterval(D(this,u)),I(this,u,void 0))},E=new WeakSet,U=function(){const i=D(this,t).getQueryCache().build(D(this,t),this.options);if(i===D(this,e))return;const r=D(this,e);I(this,e,i),I(this,s,i.state),this.hasListeners()&&(null==r||r.removeObserver(this),i.addObserver(this))},F=new WeakSet,T=function(s){K.batch((()=>{s.listeners&&this.listeners.forEach((t=>{t(D(this,i))})),D(this,t).getQueryCache().notify({query:D(this,e),type:"observerResultsUpdated"})}))},P);function Y(t,e){return function(t,e){return!1!==e.enabled&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&Z(t,e,e.refetchOnMount)}function Z(t,e,s){if(!1!==e.enabled){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&tt(t,e)}return!1}function $(t,e,s,i){return(t!==e||!1===i.enabled)&&(!s.suspense||"error"!==t.state.status)&&tt(t,s)}function tt(t,e){return!1!==e.enabled&&t.isStaleByTime(e.staleTime)}var et=N.createContext(!1),st=()=>N.useContext(et);et.Provider;var it=N.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),rt=()=>N.useContext(it);var nt=(t,e)=>{(t.suspense||t.throwOnError)&&(e.isReset()||(t.retryOnMount=!1))},at=t=>{N.useEffect((()=>{t.clearReset()}),[t])},ht=({result:t,errorResetBoundary:e,throwOnError:s,query:i})=>{return t.isError&&!e.isReset()&&!t.isFetching&&i&&(r=s,n=[t.error,i],"function"==typeof r?r(...n):!!r);var r,n},ot=t=>{t.suspense&&"number"!=typeof t.staleTime&&(t.staleTime=1e3)},lt=(t,e)=>(null==t?void 0:t.suspense)&&e.isPending,ct=(t,e,s)=>e.fetchOptimistic(t).catch((()=>{s.clearReset()}));function ut(t,e){return function(t,e,s){const i=V(),r=st(),n=rt(),a=i.defaultQueryOptions(t);a._optimisticResults=r?"isRestoring":"optimistic",ot(a),nt(a,n),at(n);const[h]=N.useState((()=>new e(i,a))),o=h.getOptimisticResult(a);if(N.useSyncExternalStore(N.useCallback((t=>{const e=r?()=>{}:h.subscribe(K.batchCalls(t));return h.updateResult(),e}),[h,r]),(()=>h.getCurrentResult()),(()=>h.getCurrentResult())),N.useEffect((()=>{h.setOptions(a,{listeners:!1})}),[a,h]),lt(a,o))throw ct(a,h,n);if(ht({result:o,errorResetBoundary:n,throwOnError:a.throwOnError,query:i.getQueryCache().get(a.queryHash)}))throw o.error;return a.notifyOnChangeProps?o:h.trackResult(o)}(t,X)}export{ut as u};
