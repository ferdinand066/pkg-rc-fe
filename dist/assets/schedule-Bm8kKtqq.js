import{p as e,q as t,u as r,a as n,b as a,j as s,t as o,r as i,B as l,v as c,w as u}from"./index-B5vbGH43.js";import{I as d}from"./InputText-oxiQjmM2.js";import{P as m}from"./PageHeader-Dllsdngb.js";import{B as f,A as b,I as g}from"./constants-5vXSpW5c.js";import{f as h}from"./format-Cr34CnP_.js";import{u as x}from"./useQuery-BZRj_2H8.js";import{A as p}from"./AlertContainer-DqwgxXkx.js";import"./startOfDay-Cqt31xqJ.js";import"./isValid-5aXsojdQ.js";var j,v,y,w,N,k,_,S,M,D,$,C,B,H,A,O,R,T,q,F,J,I,z,E,L,P,K,W,Z,G,Q,U,V,X,Y,ee,te,re,ne,ae,se,oe,ie,le;function ce(){if(S)return _;S=1;var t=function(){if(k)return N;k=1;var t="object"==typeof e&&e&&e.Object===Object&&e;return N=t}(),r="object"==typeof self&&self&&self.Object===Object&&self,n=t||r||Function("return this")();return _=n}function ue(){if(D)return M;D=1;var e=ce().Symbol;return M=e}function de(){if(O)return A;O=1;var e=ue(),t=function(){if(C)return $;C=1;var e=ue(),t=Object.prototype,r=t.hasOwnProperty,n=t.toString,a=e?e.toStringTag:void 0;return $=function(e){var t=r.call(e,a),s=e[a];try{e[a]=void 0;var o=!0}catch(l){}var i=n.call(e);return o&&(t?e[a]=s:delete e[a]),i}}(),r=function(){if(H)return B;H=1;var e=Object.prototype.toString;return B=function(t){return e.call(t)}}(),n=e?e.toStringTag:void 0;return A=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":n&&n in Object(e)?t(e):r(e)}}function me(){if(T)return R;return T=1,R=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}}function fe(){if(E)return z;E=1;var e=function(){if(F)return q;F=1;var e=de(),t=me();return q=function(r){if(!t(r))return!1;var n=e(r);return"[object Function]"==n||"[object GeneratorFunction]"==n||"[object AsyncFunction]"==n||"[object Proxy]"==n}}(),t=I?J:(I=1,J=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991});return z=function(r){return null!=r&&t(r.length)&&!e(r)}}function be(){if(W)return K;W=1;var e=w?y:(w=1,y=function(e,t){return e===t||e!=e&&t!=t}),t=fe(),r=function(){if(P)return L;P=1;var e=/^(?:0|[1-9]\d*)$/;return L=function(t,r){var n=typeof t;return!!(r=null==r?9007199254740991:r)&&("number"==n||"symbol"!=n&&e.test(t))&&t>-1&&t%1==0&&t<r}}(),n=me();return K=function(a,s,o){if(!n(o))return!1;var i=typeof s;return!!("number"==i?t(o)&&r(s,o.length):"string"==i&&s in o)&&e(o[s],a)}}function ge(){if(U)return Q;U=1;var e=function(){if(G)return Z;G=1;var e=/\s/;return Z=function(t){for(var r=t.length;r--&&e.test(t.charAt(r)););return r}}(),t=/^\s+/;return Q=function(r){return r?r.slice(0,e(r)+1).replace(t,""):r}}function he(){if(ee)return Y;ee=1;var e=de(),t=X?V:(X=1,V=function(e){return null!=e&&"object"==typeof e});return Y=function(r){return"symbol"==typeof r||t(r)&&"[object Symbol]"==e(r)}}function xe(){if(ae)return ne;ae=1;var e=function(){if(re)return te;re=1;var e=ge(),t=me(),r=he(),n=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;return te=function(i){if("number"==typeof i)return i;if(r(i))return NaN;if(t(i)){var l="function"==typeof i.valueOf?i.valueOf():i;i=t(l)?l+"":l}if("string"!=typeof i)return 0===i?i:+i;i=e(i);var c=a.test(i);return c||s.test(i)?o(i.slice(2),c?2:8):n.test(i)?NaN:+i}}(),t=1/0;return ne=function(r){return r?(r=e(r))===t||r===-1/0?17976931348623157e292*(r<0?-1:1):r==r?r:0:0===r?r:0}}function pe(){if(oe)return se;oe=1;var e=function(){if(v)return j;v=1;var e=Math.ceil,t=Math.max;return j=function(r,n,a,s){for(var o=-1,i=t(e((n-r)/(a||1)),0),l=Array(i);i--;)l[s?i:++o]=r,r+=a;return l}}(),t=be(),r=xe();return se=function(n){return function(a,s,o){return o&&"number"!=typeof o&&t(a,s,o)&&(s=o=void 0),a=r(a),void 0===s?(s=a,a=0):s=r(s),o=void 0===o?a<s?1:-1:r(o),e(a,s,o,n)}}}const je=t(function(){if(le)return ie;le=1;var e=pe()();return ie=e}()),ve=e=>(30*((e%2==0?2:e%2)-1)).toString().padStart(2,"0"),ye=({name:e,labelColor:t})=>s.jsxs("div",{className:"flex flex-row gap-1 items-center",children:[s.jsx("span",{className:o(t,"size-5 border rounded")}),s.jsx("span",{children:e})]}),we=({floors:e,borrowedRooms:t,selectedRange:i,status:l})=>{const c=new Date(`${i.date} ${i.start_time}`).getHours();let u=new Date(`${i.date} ${i.end_time}`).getHours()+1;const d="dark"===r(n),{user:m}=a();return s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex flex-row justify-end p-4 gap-4",children:[s.jsx(ye,{name:"Telah dibook",labelColor:"bg-yellow-300"}),s.jsx(ye,{name:"Disetujui",labelColor:"bg-green-300"})]}),s.jsx("div",{id:"table-container",className:o("overflow-auto scrollbar-hide",""),children:s.jsxs("table",{className:"table table-sm table-pin-rows table-pin-cols",children:[s.jsxs("thead",{className:"border",children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32",children:"Booking pada:"}),je(c,u).map((e=>s.jsx("td",{className:"border border-l-4",colSpan:2,children:`${e}:00`},e)))]}),s.jsxs("tr",{className:"top-8 border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32",children:h(i.date,"dd MMM yyyy")}),je(1,2*(u-c)+1).map((e=>{const t=(e-1)%2==0;return s.jsx("td",{className:o("border w-8 h-8",t?"border-l-4":""),children:ve(e)},e)}))]})]}),s.jsx("tbody",{children:"success"===l?e.map((e=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o(d?"bg-transparent text-gray-300":"bg-neutral-700 text-white"),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),s.jsx("td",{className:o(d?"dark:bg-transparent":"bg-neutral-700"),colSpan:2*(24-c)})]}),e.rooms.sort(((e,t)=>e.name<t.name?-1:1)).map(((e,r)=>{let n=0,a=r%2?d?"dark:bg-base-100":"bg-white":d?"dark:bg-base-300":"bg-gray-100";return s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o("border",a),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),je(1,2*(u-c)+1).map((r=>{if(n>0)return n--,null;const l=((e,t)=>{const r=--t%2*30;return`${(e+Math.floor(t/2)).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:00`})(c,r);var u=o(d?"hover:bg-neutral-600":"hover:bg-gray-200",a);const g=(h=e.id,x=l,0!==(t??[]).length&&(t??[]).find((e=>{if(e.room.id!==h)return!1;const t=e.start_borrowing_time+":00";if(t===x)return!0;const r=i.start_time+":00";return x===r&&t<r+":00"})));var h,x,p=1;g&&(u=g.borrowed_status===f?"bg-yellow-300 hover:bg-yellow-500 transition-all":"bg-green-300 hover:bg-green-500 transition-all",d&&(u=o(u,"text-black font-semibold")),p=Math.ceil(((e,t)=>{const r=new Date(`1970-01-01T${e}Z`);return(new Date(`1970-01-01T${t}Z`).getTime()-r.getTime())/6e4})(l,g.end_event_time.toString())/30),"23:59:00"===g.end_event_time.toString()&&p++,n=p-1);const j=(r-1)%2==0;return s.jsx(Ne,{transactionDetailRoom:g,boldLeft:j,columnColor:u,colSpan:p,clickable:!!g&&(g.borrowed_by_user_id===m?.id||m?.role===b)},r)}))]},r)}))]},e.id))):s.jsx(ke,{isDarkTheme:d,startHour:c})})]})})]})},Ne=({transactionDetailRoom:e,boldLeft:t,columnColor:r,colSpan:n,clickable:a})=>{const[l,c]=i.useState(!0),u=i.useRef(null);return i.useEffect((()=>{const e=()=>{const e=u.current?.closest("tr").querySelector("th");if(e&&u.current){const t=e.getBoundingClientRect(),r=u.current.getBoundingClientRect().left-t.left;c(!(r<150))}},t=document.getElementById("table-container");return t?.addEventListener("scroll",e),()=>{t?.removeEventListener("scroll",e)}}),[]),s.jsx("td",{ref:u,onClick:()=>{if(!e)return;if(!a)return;const t="/room-request/"+e.id;window.open(t,"_blank")},className:o("border w-8 h-8 cursor-pointer -z-10",t?"border-l-4":"",r),colSpan:n,children:e&&s.jsxs("div",{className:o("group cursor-pointer",l?"relative":""),children:[s.jsx("div",{className:"truncate",style:{maxWidth:2*n+"rem"},children:e.event_name}),s.jsxs("span",{className:"absolute -top-14 left-1/2 -translate-x-1/2 scale-0 transition-transform duration-200 ease-out group-hover:scale-100 p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg flex flex-col min-w-32",children:[s.jsx("span",{children:`${e.start_borrowing_time} - ${e.end_event_time}`}),s.jsxs("span",{children:[e.pic_name," (",e.pic_phone_number,")"]})]})]})})},ke=({isDarkTheme:e,startHour:t})=>s.jsx("tr",{className:"border",children:s.jsx("th",{className:o(e?"bg-transparent text-gray-300 border-b":"bg-neutral-700 text-white"),colSpan:2*(24-t)+1,children:s.jsxs("span",{className:"w-32 flex flex-row items-end gap-0.5",children:["Loading",s.jsx("span",{className:"loading loading-dots loading-xs"})]})})});class _e extends l{static async getRoomSchedules(){const{data:e}=await this._get("https://booking-api.parokipik.org/general/room-schedule");return e.floors}static async getSchedules(e){try{const{data:t}=await this._get("https://booking-api.parokipik.org/general/schedule",e);return t.borrowedRooms}catch(t){throw new Error(t.message)}}}const Se=()=>{const e=(()=>{const e=new Date;return e.getHours()>18&&e.setHours(18),e.setMinutes(0,0,0),e})(),[t,a]=i.useState([]),l="dark"===r(n),[f,b]=i.useState({date:h(e,"yyyy-MM-dd"),start_time:h(e,"HH")+":00",end_time:"23:59"}),[j,v]=i.useState({date:h(e,"yyyy-MM-dd"),start_time:h(e,"HH")+":00",end_time:"23:59"}),{data:y,status:w}=(()=>{const{data:e,status:t}=x({queryKey:["general/room-schedules"],queryFn:()=>_e.getRoomSchedules()});return{data:e,status:t}})(),{data:N,status:k}=(e=>{const{data:t,status:r}=x({queryKey:["general/schedule",e],queryFn:()=>_e.getSchedules(e),placeholderData:(e,t)=>e||void 0});return{data:t,status:r}})(j),_=e=>{const{date:t}=j,r=new Date(t);e(r);const n=h(r,"yyyy-MM-dd");b((e=>({...e,date:n}))),v((e=>({...e,date:n})))};return s.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4 mb-24",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[s.jsx(m,{pageName:"Jadwal"}),s.jsx("div",{className:"px-6 w-full flex justify-end",children:s.jsxs("div",{className:"join w-full sm:w-auto",children:[s.jsx("button",{onClick:()=>_((e=>e.setDate(e.getDate()+1))),className:o("btn join-item flex-1",l?"bg-neutral":"bg-white"),children:"Next Day"}),s.jsx("button",{onClick:()=>_((e=>e.setDate(e.getDate()+7))),className:o("btn join-item flex-1",l?"bg-neutral":"bg-white"),children:"Next Week"}),s.jsx("button",{onClick:()=>_((e=>e.setMonth(e.getMonth()+1))),className:o("btn join-item flex-1",l?"bg-neutral":"bg-white"),children:"Next Month"})]})})]}),s.jsxs("div",{className:"mx-6 flex flex-col md:flex-row items-end gap-4",children:[s.jsx(d,{type:"date",min:e.toISOString().split("T")[0],label:"Tanggal Booking",value:f.date,onChange:e=>{const t=e.target.value;b((e=>({...e,date:t})))}}),s.jsx(d,{type:"time",step:g,label:"Jam Awal Booking",value:f.start_time,onChange:e=>b((t=>({...t,start_time:e.target.value})))}),s.jsx(d,{type:"time",step:g,label:"Jam Akhir Booking",value:f.end_time,onChange:e=>b((t=>({...t,end_time:e.target.value})))}),s.jsx("button",{className:"btn btn-primary w-full md:w-auto",type:"button",onClick:()=>{const e=new Date(`${f.date} ${f.start_time}`).getHours(),t=new Date(`${f.date} ${f.end_time}`).getHours();if(t<e)a([{message:"Jam Akhir Booking tidak boleh kurang dari Jam Awal Booking!"}]);else if(t-e<1)a([{message:"Jam Akhir Booking harus memiliki jarak minimal 1 jam dari Jam Awal Booking!"}]);else{if(t-e<6){let r=e,n=t;const a=Math.floor((e+t)/2);e<=6?(r=0,n=6):e>=18?(r=18,n=23):(r=Math.max(0,a-Math.floor(3)),n=Math.min(23,r+6));const s={...f,start_time:c.padStart(r.toString(),2,"0")+":00",end_time:c.padStart(n.toString(),2,"0")+":00"};b(s),v(s)}else v(f);a([])}},children:"Cari"})]}),s.jsx(p,{notification:t}),s.jsx("div",{className:"mx-6",children:s.jsx(we,{floors:y,borrowedRooms:N,selectedRange:j,status:u(k,w)})})]})};export{Se as default};
