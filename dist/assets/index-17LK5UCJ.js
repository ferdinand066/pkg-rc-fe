import{B as e,c as t,f as a,h as s,r,Q as i,i as o,k as n,j as l}from"./index-CoHiygy3.js";import{P as m}from"./PageHeader-DDeztv-2.js";import{u,D as c}from"./use-item-BDAj-h9P.js";import{T as d,P as g}from"./Table-DY6lS2rF.js";import{u as p}from"./use-room-_WmYEM-v.js";import{I as f}from"./InputSelect-wkVSoLyP.js";import{u as h,I as y}from"./InputText-Bd-nKs3U.js";import{I as x}from"./InputToggle-GF51Ct7s.js";import{u as j}from"./useQuery-D4UjwIFn.js";import"./isValid-5aXsojdQ.js";const b="https://booking-api.reginacaeli.id/admin/room";class v extends e{static async createRoom(e){try{return await this._post(`${b}`,e)}catch(t){throw new Error(t.message)}}static async updateRoom(e,t){if(!e)return null;try{return await this._patch(`${b}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteRoom(e){if(e)try{return await this._delete(`${b}/${e}`,{})}catch(t){throw new Error(t.message)}}}const w="https://booking-api.reginacaeli.id/general/floor";class _ extends e{static async getFloors(e){try{const{data:t}=await this._get(`${w}`,e);return t.floors}catch(t){throw new Error(t.message)}}static async getOneFloor(e){if(!e)return null;try{const{data:t}=await this._get(`${w}/${e}`);return t.floor}catch(t){throw new Error(t.message)}}}const R=r.forwardRef((({selectedRoom:e},m)=>{const{data:c,status:d}=(e=>{const{data:t,status:a}=j({queryKey:["general/floor",e],queryFn:()=>_.getFloors(e)});return{data:t,status:a}})({orderBy:"created_at",dataOrder:"asc"}),{data:g,status:p}=u({},!1),[b,w]=r.useState(e),R=g;r.useEffect((()=>{if("success"!==p)return;if(!e)return void w(void 0);const t=new Map;null==R||R.forEach(((e,a)=>t.set(e.id,a)));const a=new Array((null==R?void 0:R.length)??0);for(const r of(null==e?void 0:e.item_id)??[]){const e=t.get(r);void 0!==e&&(a[e]=r)}const s={...e,item_id:a};w(s)}),[p,e]);const{register:$,setValue:q,errors:N,handleManageRoom:k,handleDeleteRoom:E,handleSubmit:S,watch:V}=((e=null)=>{const{register:l,setValue:m,getValues:u,formState:{errors:c},handleSubmit:d,watch:g,reset:p}=h(),[f,y]=t(a),x=s();return r.useEffect((()=>{var t;p(),e&&(Object.keys(e).filter((e=>!["room_items","item_id"].includes(e))).forEach((t=>{m(t,e[t])})),null==(t=e.room_items)||t.map((t=>{var a;const s=null==(a=e.item_id)?void 0:a.indexOf(t.item_id);void 0!==s&&(s<0||(m(`items.${s}.item_id`,t.item_id),m(`items.${s}.quantity`,t.quantity)))})))}),[e,m]),{register:l,setValue:m,getValues:u,errors:c,handleManageRoom:async function(t){if(!f){t={...t,items:t.items.filter((e=>!!e.item_id))},y(!0);try{e?await i.promise(v.updateRoom(e.id,t),{pending:"Waiting for update room!",error:o(),success:n()}):await i.promise(v.createRoom(t),{pending:"Waiting for create room!",error:o(),success:n()})}catch(a){}x.invalidateQueries({queryKey:["general/room"]}),null!==e&&x.invalidateQueries({queryKey:["general/room",e.id]}),p(),y(!1)}},handleDeleteRoom:async function(){if(e&&!f){y(!0);try{await i.promise(v.deleteRoom(e.id),{pending:"Waiting for delete room!",error:o(),success:n()})}catch(t){}y(!1),p(),x.invalidateQueries({queryKey:["general/room"]})}},handleSubmit:d,watch:g}})(b);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Ruangan":"Buat Ruangan"}),l.jsxs("form",{onSubmit:S((async e=>{var t;await k(e),null==(t=m.current)||t.close()})),className:"flex flex-col gap-2",children:[l.jsx(y,{label:"Nama Ruangan",type:"text",name:"name",register:$("name",{required:"Nama ruangan harus diisi"}),setValue:q,placeholder:"Cth: Bartolomeus",errors:N}),"success"===d?l.jsx(f,{label:"Lantai",name:"floor_id",register:$("floor_id",{required:"Lantai harus diisi"}),setValue:q,model:c??[],errors:N}):l.jsx(l.Fragment,{}),l.jsx(y,{label:"Kapasitas",type:"number",name:"capacity",register:$("capacity",{required:"Kapasitas harus diisi"}),min:1,setValue:q,errors:N}),l.jsx("span",{}),"success"===p?null==R?void 0:R.map(((e,t)=>{const a=V(`items.${t}.item_id`);return l.jsxs("div",{className:"grid grid-cols-3 items-center",children:[l.jsx(x,{label:e.name,name:`items.${t}.item_id`,id:`items.${t}.item_i d`,value:e.id,register:$(`items.${t}.item_id`),inputContainerClassName:"col-span-2",errors:N}),!!a&&l.jsx(y,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${t}.quantity`,id:`items.${t}.quantity`,register:$(`items.${t}.quantity`,{required:"Harus diisi"}),errors:N})]},e.id)})):l.jsx(l.Fragment,{}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>{var e;return null==(e=m.current)?void 0:e.close()},children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>{var e;return await E(),null==(e=m.current)?void 0:e.close()},children:"Hapus"})]})]})]})})),$=["name","floor_name","items"],q=()=>{const[e,t]=r.useState({page:1}),{data:a,status:s}=p(e,!0),i=a,o=null==i?void 0:i.data.map((e=>{var t,a;const s={...e,floor_name:e.floor.name,items:null==(t=null==e?void 0:e.room_items)?void 0:t.map((e=>e.item.name)).join(", "),item_id:null==(a=null==e?void 0:e.room_items)?void 0:a.map((e=>e.item_id))};return{...s,items:s.items?s.items:"-",onClick:()=>{var e;u(s),null==(e=f.current)||e.showModal()}}})),[n,u]=r.useState(),f=r.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(m,{pageName:"Ruangan",action:l.jsx(c,{buttonText:"Tambah Ruangan",onClick:()=>u(void 0),ref:f,children:l.jsx(R,{selectedRoom:n,ref:f})})}),l.jsx(d,{header:$,data:o??[],status:s}),l.jsx(g,{status:s,data:i,page:e.page,setPage:t})]})};export{q as default};
