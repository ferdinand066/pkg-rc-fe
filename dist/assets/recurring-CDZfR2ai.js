import{d as e,f as a,h as s,m as r,Q as i,i as t,k as n,r as l,j as m}from"./index-B5vbGH43.js";import{I as o}from"./InputSelect-DHMY61xc.js";import{u as d,I as u}from"./InputText-oxiQjmM2.js";import{I as c}from"./InputTextarea-DXiRLjgl.js";import{I as p}from"./InputToggle-CBumxM5-.js";import{P as g}from"./PageHeader-Dllsdngb.js";import{B as h,p as j,i as x,a as b}from"./borrowed-room-service-oKA1RtLt.js";import{u as _}from"./use-room-D8Vw2KTw.js";import{I as f}from"./constants-5vXSpW5c.js";import{i as v}from"./isBefore-BU7b8VsE.js";import"./startOfDay-Cqt31xqJ.js";import"./isValid-5aXsojdQ.js";import"./useQuery-BZRj_2H8.js";const N=[{id:"daily",name:"Harian"},{id:"weekly",name:"Mingguan"},{id:"monthly",name:"Bulanan"}],w=()=>{const{data:w,status:V}=_({},{order_by:"name",data_order:"asc"},!1),{register:q,setValue:T,errors:I,handleManageBorrowedRoom:P,handleSubmit:S,watch:k,getValues:$}=(()=>{const{register:l,setValue:m,getValues:o,formState:{errors:u},handleSubmit:c,watch:p,reset:g,formState:j}=d(),[x,b]=e(a),_=s(),f=r();return{register:l,setValue:m,errors:u,handleManageBorrowedRoom:async function(e){if(!x){e={...e,items:e.items.filter((e=>!!e.item_id))},b(!0);try{await i.promise(h.createRecurringBorrowedRoom(e),{pending:"Waiting for create borrowed room!",error:n(),success:t()})}catch{}_.invalidateQueries({queryKey:["general/borrowed-room"]}),b(!1),g(),f("/room-request")}},handleSubmit:c,watch:p,getValues:o,formState:j}})(),B=k("room_id"),[J,C]=l.useState(!1);return l.useEffect((()=>{if("success"!==V)return;if(J)return;C(!0);T("room_id",w[0].id)}),[J,V]),m.jsx("section",{className:"flex flex-col h-full flex-1 gap-4 mb-8 divide-y",children:m.jsxs("div",{className:"flex flex-col",children:[m.jsx(g,{pageName:"Buat Proposal Pinjam Ruang Berulang"}),m.jsxs("form",{onSubmit:S(P),className:"grid grid-cols-6 gap-4 mx-6",children:[m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(u,{label:"Nama Kegiatan",type:"text",name:"event_name",placeholder:"Contoh: Acara Natal",register:q("event_name",{required:"Nama kegiatan harus diisi"}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(o,{label:"Berulang Setiap",name:"recurring",register:q("recurring",{required:"Jangka berulang harus diisi"}),setValue:T,model:N.map((e=>({id:e.id,name:e.name}))),errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(u,{label:"Nama PIC",type:"text",name:"pic_name",placeholder:"Tuliskan nama anda",register:q("pic_name",{required:"Nama PIC harus diisi"}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(u,{label:"No. Telp PIC",type:"text",name:"pic_phone_number",placeholder:"Format: 08.....",register:q("pic_phone_number",{required:"No. Telp PIC harus diisi"}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(u,{label:"Mulai Pinjam",type:"date",name:"start_borrowed_date",register:q("start_borrowed_date",{required:"Tanggal mulai harus diisi",validate:e=>{const a=j(e),s=new Date;return!(!x(a,s)&&!b(a,s))||"Tanggal peminjaman awal harus setelah hari ini"}}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(u,{label:"Selesai Pinjam",type:"date",name:"end_borrowed_date",register:q("end_borrowed_date",{required:"Tanggal peminjaman akhir harus diisi",validate:e=>{const a=j(e),s=new Date;if(!x(a,s)&&!b(a,s))return"Tanggal peminjaman akhir harus setelah hari ini";const r=$("start_borrowed_date");return!v(a,r)||"Tanggal peminjaman akhir harus setelah tanggal mulai peminjaman"}}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Kapasitas",type:"number",name:"capacity",register:q("capacity",{required:"Kapasitas harus diisi"}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(o,{label:"Ruangan",name:"room_id",register:q("room_id",{required:"Ruangan harus diisi"}),setValue:T,model:(w??[]).map((e=>({id:e.id,name:e.name+" ("+e.floor.name+")"})))??[],errors:I,isLoading:"pending"===V})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Mulai Pinjam",type:"time",step:f,name:"start_borrowing_time",register:q("start_borrowing_time",{required:"Jam mulai pinjam harus diisi"}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Mulai Acara",type:"time",step:f,name:"start_event_time",register:q("start_event_time",{required:"Jam mulai acara harus diisi",validate:e=>{const a=$("start_borrowing_time"),s=new Date(`2000-01-01T${a}`);if(v(new Date(`2000-01-01T${e}`),s))return"Jam mulai harus setelah jam mulai pinjam"}}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(u,{label:"Jam Selesai Pinjam",type:"time",step:f,name:"end_event_time",register:q("end_event_time",{required:"Jam akhir harus diisi",validate:e=>{const a=$("start_event_time"),s=new Date(`2000-01-01T${a}`);if(!x(new Date(`2000-01-01T${e}`),s))return"Jam akhir event harus setelah jam mulai event"}}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:"pending"===V?m.jsx(y,{}):B&&w&&w.find((e=>e.id===B))?.room_items?.map(((e,a)=>{const s=k(`items.${a}.item_id`);return m.jsxs("div",{className:"grid grid-cols-3 items-center",children:[m.jsx(p,{label:e.item.name,name:`items.${a}.item_id`,id:`items.${a}.item_id`,value:e.item_id,register:q(`items.${a}.item_id`),inputContainerClassName:"col-span-2",errors:I}),!!s&&m.jsx(u,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${a}.quantity`,id:`items.${a}.quantity`,register:q(`items.${a}.quantity`,{required:"Harus diisi"}),setValue:T,errors:I})]},e.id)}))}),m.jsx("div",{className:"col-span-6",children:m.jsx(c,{label:"Keterangan",name:"description",id:"description",register:q("description",{required:"Keterangan harus diisi"}),setValue:T,errors:I})}),m.jsx("div",{className:"col-span-6 modal-action flex-row-reverse justify-between",children:m.jsxs("div",{className:"flex flex-row gap-4",children:[m.jsx("button",{className:"btn btn-neutral",type:"button",children:"Tutup"}),m.jsx("button",{className:"btn btn-primary",type:"submit",children:"Buat"})]})})]})]})})},y=()=>m.jsxs("div",{className:"flex flex-row gap-4 px-1 items-center",children:[m.jsx("div",{className:"bg-base-300 min-w-12 animate-pulse rounded-full h-7"}),m.jsx("div",{className:"bg-base-300 min-w-32 animate-pulse rounded-full h-6"})]});export{w as default};
