import{B as e,u as a,f as t,a as s,r as i,Q as r,h as n,b as l,w as m,d as o,j as u}from"./index-DpP_SUQ6.js";import{u as d,a as c,I as p}from"./input-text-Ds8sWXwC.js";import{I as h}from"./input-select-BvffwCdU.js";import{P as b}from"./page-header-xlds1YNX.js";import{T as g}from"./table-CI8tVEnI.js";import{a as x}from"./use-item-B9CYe6o5.js";import{u as f}from"./use-room-Ckk35-Rt.js";import"./useQuery-C6faGm9h.js";import"./isValid-5aXsojdQ.js";const y="https://booking-api.parokipik.org/admin/item";class j extends e{static async createItem(e){return await this._post(`${y}`,e)}static async updateItem(e,a){if(e)return await this._patch(`${y}/${e}`,a)}static async deleteItem(e){if(e)return await this._delete(`${y}/${e}`,{})}}const _=()=>{const{id:e}=m(),y=o(),_=!e,{data:N,status:v}=x(e??""),q=_?null:N??null,{data:I}=f({},{},!1),{register:w,setValue:k,errors:S,handleManageItem:B,handleDeleteItem:V,handleSubmit:$,watch:R,roomItemFields:C,appendRoomItem:J,removeRoomItem:K}=((e=null)=>{const{register:m,setValue:o,control:u,formState:{errors:p},handleSubmit:h,watch:b,reset:g}=d({defaultValues:{name:"",idle_quantity:0,room_items:[]}}),{fields:x,append:f,remove:y}=c({control:u,name:"room_items"}),[_,N]=a(t),v=s();return i.useEffect((()=>{if(!e)return void g({name:"",idle_quantity:0,room_items:[]});const a=(e.room_items??[]).map((e=>({room_id:e.room_id,quantity:e.quantity})));g({name:e.name??"",idle_quantity:Number(e.idle_quantity)??0,room_items:a})}),[e,g]),{register:m,setValue:o,errors:p,handleManageItem:async function(a){if(!_){N(!0);try{const{room_items:t,...s}=a,i={...s,idle_quantity:Number(a.idle_quantity)||0};return e||(i.room_items=(a.room_items??[]).map((e=>({room_id:e.room_id,quantity:Number(e.quantity)||0})))),e?await r.promise(j.updateItem(e.id,i),{pending:"Waiting for update item!",error:l(),success:n()}):await r.promise(j.createItem(i),{pending:"Waiting for create item!",error:l(),success:n()}),v.invalidateQueries({queryKey:["general/item"]}),null!==e&&v.invalidateQueries({queryKey:["general/item",e.id]}),g(),!0}catch(t){return!1}finally{N(!1)}}},handleDeleteItem:async function(){if(e&&!_){N(!0);try{return await r.promise(j.deleteItem(e.id),{pending:"Waiting for delete item!",error:l(),success:n()}),g(),v.invalidateQueries({queryKey:["general/item"]}),!0}catch(a){return!1}finally{N(!1)}}},handleSubmit:h,watch:b,roomItemFields:x,appendRoomItem:f,removeRoomItem:y}})(q),M=R("room_items")??[],Q=e=>{const a=new Set(M.map(((a,t)=>t!==e&&a?.room_id?String(a.room_id):null)).filter(Boolean));return(I??[]).filter((t=>!a.has(String(t.id))||String(M[e]?.room_id)===String(t.id)))};return _||"pending"!==v?_||"success"!==v||N?u.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[u.jsx(b,{pageName:_?"Buat Barang":"Ubah Barang"}),u.jsx("div",{className:"px-6 pb-6",children:u.jsxs("form",{onSubmit:$((async e=>{await B(e)&&y("/inventory/item")})),className:"flex flex-col gap-4",children:[u.jsxs("div",{className:"grid grid-cols-6 gap-2",children:[u.jsx("div",{className:"col-span-4",children:u.jsx(p,{label:"Nama Barang",type:"text",name:"name",register:w("name",{required:"Nama barang harus diisi"}),setValue:k,placeholder:"Cth: Speaker Portable",errors:S})}),u.jsx("div",{className:"col-span-2",children:u.jsx(p,{label:"Jumlah Idle",type:"number",name:"idle_quantity",register:w("idle_quantity",{valueAsNumber:!0,min:{value:0,message:"Jumlah idle tidak boleh negatif"}}),setValue:k,placeholder:"0",errors:S,disabled:!_})})]}),u.jsxs("div",{className:"flex flex-col gap-2",children:[u.jsx("h4",{className:"font-medium",children:"Jumlah per Ruangan"}),_?u.jsxs(u.Fragment,{children:[C.map(((e,a)=>u.jsxs("div",{className:"grid grid-cols-6 gap-2 items-end",children:[u.jsx("div",{className:"col-span-3",children:u.jsx(h,{label:0===a?"Ruangan":void 0,name:`room_items.${a}.room_id`,register:w(`room_items.${a}.room_id`,{required:"Ruangan harus dipilih"}),setValue:k,model:Q(a),errors:S})}),u.jsx("div",{className:"col-span-2",children:u.jsx(p,{label:0===a?"Jumlah":void 0,type:"number",name:`room_items.${a}.quantity`,register:w(`room_items.${a}.quantity`,{valueAsNumber:!0,min:{value:1,message:"Jumlah harus lebih dari nol"}}),setValue:k,placeholder:"0",errors:S})}),u.jsx("div",{className:"col-span-1 flex items-end pb-2",children:u.jsx("button",{type:"button",className:"btn btn-ghost btn-sm btn-square",onClick:()=>K(a),"aria-label":"Hapus ruangan",children:"âœ•"})})]},e.id))),u.jsx("button",{type:"button",className:"btn btn-outline w-fit",onClick:()=>J({room_id:"",quantity:0}),children:"Tambah Ruangan"})]}):u.jsx(g,{header:[{name:"ruangan",sortable:!1},{name:"jumlah",sortable:!1}],data:(q?.room_items??[]).map((e=>({ruangan:e.room?.name??"-",jumlah:e.quantity}))),status:"success"})]}),u.jsxs("div",{className:"flex flex-row justify-between gap-2",children:[u.jsx("button",{className:"btn w-20 bg-base-100 hover:bg-gray-200 border-none",type:"button",onClick:()=>y("/inventory/item"),children:"Kembali"}),u.jsxs("div",{className:"flex flex-row gap-2",children:[u.jsx("button",{className:"btn btn-primary",type:"submit",children:_?"Buat":"Ubah"}),!_&&u.jsx("button",{className:"btn btn-error",type:"button",onClick:async()=>{await V()&&y("/inventory/item")},children:"Hapus"})]})]})]})})]}):u.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[u.jsx(b,{pageName:"Barang tidak ditemukan"}),u.jsx("div",{className:"px-6",children:u.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>y("/inventory/item"),children:"Kembali ke Daftar Barang"})})]}):u.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[u.jsx(b,{pageName:"Memuat..."}),u.jsx("div",{className:"px-6",children:"Memuat barang..."})]})};export{_ as default};
