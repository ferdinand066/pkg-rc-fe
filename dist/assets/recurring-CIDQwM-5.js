import{u as e,f as a,a as s,d as r,Q as i,h as t,b as n,r as l,j as m,I as o}from"./index-DpP_SUQ6.js";import{I as d}from"./input-select-BvffwCdU.js";import{u,I as c}from"./input-text-Ds8sWXwC.js";import{I as p}from"./input-textarea-B0h35171.js";import{i as g,I as h}from"./input-toggle-DpJsb5h-.js";import{P as j}from"./page-header-xlds1YNX.js";import{B as x,p as b,i as f,a as _}from"./borrowed-room-service-DlN0d7Sv.js";import{u as v}from"./use-room-Ckk35-Rt.js";import{t as N}from"./isValid-5aXsojdQ.js";import{c as w}from"./constructFrom-BpBbSY1L.js";import"./startOfDay-Cqt31xqJ.js";import"./useQuery-C6faGm9h.js";function y(e,a){return function(e,a){const s=N(e);if(isNaN(a))return w(e,NaN);const r=s.getDate(),i=w(e,s.getTime());return i.setMonth(s.getMonth()+a+1,0),r>=i.getDate()?i:(s.setFullYear(i.getFullYear(),i.getMonth(),r),s)}(e,12*a)}const V=[{id:"daily",name:"Harian"},{id:"weekly",name:"Mingguan"},{id:"monthly",name:"Bulanan"}],q=()=>{const{data:N,status:w}=v({},{order_by:"name",data_order:"asc"},!1),{register:q,setValue:k,errors:P,handleManageBorrowedRoom:S,handleSubmit:$,watch:D,getValues:J}=(()=>{const{register:l,setValue:m,getValues:o,formState:{errors:d},handleSubmit:c,watch:p,reset:g,formState:h}=u(),[j,b]=e(a),f=s(),_=r();return{register:l,setValue:m,errors:d,handleManageBorrowedRoom:async function(e){if(!j){e={...e,items:e.items.filter((e=>!!e.item_id))},b(!0);try{await i.promise(x.createRecurringBorrowedRoom(e),{pending:"Waiting for create borrowed room!",error:n(),success:t()})}catch{}f.invalidateQueries({queryKey:["general/borrowed-room"]}),b(!1),g(),_("/room-request")}},handleSubmit:c,watch:p,getValues:o,formState:h}})(),B=D("room_id"),[I,M]=l.useState(!1);return l.useEffect((()=>{if("success"!==w)return;if(I)return;M(!0);k("room_id",N[0].id)}),[I,w,N,k]),m.jsx("section",{className:"flex flex-col h-full flex-1 gap-4 mb-8 divide-y",children:m.jsxs("div",{className:"flex flex-col",children:[m.jsx(j,{pageName:"Buat Proposal Pinjam Ruang Berulang"}),m.jsxs("form",{onSubmit:$(S),className:"grid grid-cols-6 gap-4 mx-6",children:[m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(c,{label:"Nama Kegiatan",type:"text",name:"event_name",placeholder:"Contoh: Acara Natal",register:q("event_name",{required:"Nama kegiatan harus diisi"}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(d,{label:"Berulang Setiap",name:"recurring",register:q("recurring",{required:"Jangka berulang harus diisi"}),setValue:k,model:V.map((e=>({id:e.id,name:e.name}))),errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(c,{label:"Nama PIC",type:"text",name:"pic_name",placeholder:"Tuliskan nama anda",register:q("pic_name",{required:"Nama PIC harus diisi"}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-2",children:m.jsx(c,{label:"No. Telp PIC",type:"text",name:"pic_phone_number",placeholder:"Format: 08.....",register:q("pic_phone_number",{required:"No. Telp PIC harus diisi"}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(c,{label:"Mulai Pinjam",type:"date",name:"start_borrowed_date",register:q("start_borrowed_date",{required:"Tanggal mulai harus diisi",validate:e=>{const a=b(e),s=new Date;return!(!f(a,s)&&!_(a,s))||"Tanggal peminjaman awal harus setelah hari ini"}}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-3 lg:col-span-1",children:m.jsx(c,{label:"Selesai Pinjam",type:"date",name:"end_borrowed_date",register:q("end_borrowed_date",{required:"Tanggal peminjaman akhir harus diisi",validate:e=>{const a=b(e),s=new Date;if(!f(a,s)&&!_(a,s))return"Tanggal peminjaman akhir harus setelah hari ini";const r=J("start_borrowed_date");if(g(a,r))return"Tanggal peminjaman akhir harus setelah tanggal mulai peminjaman";const i=y(b(r),1);return!f(a,i)||"Tanggal peminjaman akhir maksimal 1 tahun setelah tanggal mulai peminjaman"}}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(c,{label:"Kapasitas",type:"number",name:"capacity",register:q("capacity",{required:"Kapasitas harus diisi"}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:m.jsx(d,{label:"Ruangan",name:"room_id",register:q("room_id",{required:"Ruangan harus diisi"}),setValue:k,model:(N??[]).map((e=>({id:e.id,name:e.name+" ("+e.floor.name+")"})))??[],errors:P,isLoading:"pending"===w})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(c,{label:"Jam Mulai Pinjam",type:"time",step:o,name:"start_borrowing_time",register:q("start_borrowing_time",{required:"Jam mulai pinjam harus diisi"}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(c,{label:"Jam Mulai Acara",type:"time",step:o,name:"start_event_time",register:q("start_event_time",{required:"Jam mulai acara harus diisi",validate:e=>{const a=J("start_borrowing_time"),s=new Date(`2000-01-01T${a}`);if(g(new Date(`2000-01-01T${e}`),s))return"Jam mulai harus setelah jam mulai pinjam"}}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-2",children:m.jsx(c,{label:"Jam Selesai Pinjam",type:"time",step:o,name:"end_event_time",register:q("end_event_time",{required:"Jam akhir harus diisi",validate:e=>{const a=J("start_event_time"),s=new Date(`2000-01-01T${a}`);if(!f(new Date(`2000-01-01T${e}`),s))return"Jam akhir event harus setelah jam mulai event"}}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 sm:col-span-4",children:"pending"===w?m.jsx(T,{}):B&&N&&N.find((e=>e.id===B))?.room_items?.map(((e,a)=>{const s=D(`items.${a}.item_id`);return m.jsxs("div",{className:"grid grid-cols-3 items-center",children:[m.jsx(h,{label:e.item.name,name:`items.${a}.item_id`,id:`items.${a}.item_id`,value:e.item_id,register:q(`items.${a}.item_id`),inputContainerClassName:"col-span-2",errors:P}),!!s&&m.jsx(c,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${a}.quantity`,id:`items.${a}.quantity`,register:q(`items.${a}.quantity`,{required:"Harus diisi"}),setValue:k,errors:P})]},e.id)}))}),m.jsx("div",{className:"col-span-6",children:m.jsx(p,{label:"Keterangan",name:"description",id:"description",register:q("description",{required:"Keterangan harus diisi"}),setValue:k,errors:P})}),m.jsx("div",{className:"col-span-6 modal-action flex-row-reverse justify-between",children:m.jsxs("div",{className:"flex flex-row gap-4",children:[m.jsx("button",{className:"btn btn-neutral",type:"button",children:"Tutup"}),m.jsx("button",{className:"btn btn-primary",type:"submit",children:"Buat"})]})})]})]})})},T=()=>m.jsxs("div",{className:"flex flex-row gap-4 px-1 items-center",children:[m.jsx("div",{className:"bg-base-300 min-w-12 animate-pulse rounded-full h-7"}),m.jsx("div",{className:"bg-base-300 min-w-32 animate-pulse rounded-full h-6"})]});export{q as default};
