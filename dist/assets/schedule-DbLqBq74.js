import{p as e,q as t,u as r,e as a,a as n,j as s,t as o,B as i,r as l,P as c,v as d}from"./index-CI2_iiYJ.js";import{I as u}from"./InputText-CUIDzXwA.js";import{A as m}from"./constants-qRkPKk_L.js";import{u as g}from"./useQuery-CPfaIPLg.js";import{A as b}from"./AlertContainer-BJPOcdJU.js";import{f}from"./format-BbihwMOe.js";import"./startOfDay-Cqt31xqJ.js";import"./isValid-5aXsojdQ.js";var h=Math.ceil,p=Math.max;var j=function(e,t,r,a){for(var n=-1,s=p(h((t-e)/(r||1)),0),o=Array(s);s--;)o[a?s:++n]=e,e+=r;return o};var x=function(e,t){return e===t||e!=e&&t!=t},v="object"==typeof e&&e&&e.Object===Object&&e,y="object"==typeof self&&self&&self.Object===Object&&self,w=(v||y||Function("return this")()).Symbol,N=w,k=Object.prototype,S=k.hasOwnProperty,T=k.toString,$=N?N.toStringTag:void 0;var _=function(e){var t=S.call(e,$),r=e[$];try{e[$]=void 0;var a=!0}catch(s){}var n=T.call(e);return a&&(t?e[$]=r:delete e[$]),n},A=Object.prototype.toString;var O=_,C=function(e){return A.call(e)},D=w?w.toStringTag:void 0;var H=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":D&&D in Object(e)?O(e):C(e)};var B=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},M=H,q=B;var F=function(e){if(!q(e))return!1;var t=M(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},J=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var R=/^(?:0|[1-9]\d*)$/;var z=x,I=function(e){return null!=e&&J(e.length)&&!F(e)},P=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&R.test(e))&&e>-1&&e%1==0&&e<t},K=B;var Z=/\s/;var E=function(e){for(var t=e.length;t--&&Z.test(e.charAt(t)););return t},G=/^\s+/;var L=H,Q=function(e){return null!=e&&"object"==typeof e};var U=function(e){return e?e.slice(0,E(e)+1).replace(G,""):e},V=B,W=function(e){return"symbol"==typeof e||Q(e)&&"[object Symbol]"==L(e)},X=/^[-+]0x[0-9a-f]+$/i,Y=/^0b[01]+$/i,ee=/^0o[0-7]+$/i,te=parseInt;var re=function(e){if("number"==typeof e)return e;if(W(e))return NaN;if(V(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=V(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=U(e);var r=Y.test(e);return r||ee.test(e)?te(e.slice(2),r?2:8):X.test(e)?NaN:+e},ae=1/0;var ne=j,se=function(e,t,r){if(!K(r))return!1;var a=typeof t;return!!("number"==a?I(r)&&P(t,r.length):"string"==a&&t in r)&&z(r[t],e)},oe=function(e){return e?(e=re(e))===ae||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const ie=t(function(e){return function(t,r,a){return a&&"number"!=typeof a&&se(t,r,a)&&(r=a=void 0),t=oe(t),void 0===r?(r=t,t=0):r=oe(r),a=void 0===a?t<r?1:-1:oe(a),ne(t,r,a,e)}}()),le=e=>(30*((e%2==0?2:e%2)-1)).toString().padStart(2,"0"),ce=({name:e,labelColor:t})=>s.jsxs("div",{className:"flex flex-row gap-1 items-center",children:[s.jsx("span",{className:o(t,"size-5 border rounded")}),s.jsx("span",{children:e})]}),de=({floors:e,borrowedRooms:t,selectedRange:i,status:l})=>{const c=new Date(`${i.date} ${i.startTime}`).getHours();let d=new Date(`${i.date} ${i.endTime}`).getHours()+1;const u="dark"===r(a),{user:g}=n();return s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex flex-row justify-end p-4 gap-4",children:[s.jsx(ce,{name:"Booked",labelColor:"bg-yellow-300"}),s.jsx(ce,{name:"Confirmed",labelColor:"bg-green-300"})]}),s.jsx("div",{className:o("overflow-auto scrollbar-hide",""),children:s.jsxs("table",{className:"table table-sm table-pin-rows table-pin-cols",children:[s.jsxs("thead",{className:"border",children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32"}),ie(c,d).map((e=>s.jsx("td",{className:"border border-l-4",colSpan:2,children:`${e}:00`},e)))]}),s.jsxs("tr",{className:"top-8 border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32"}),ie(1,2*(d-c)+1).map((e=>{const t=(e-1)%2==0;return s.jsx("td",{className:o("border w-4 h-8",t?"border-l-4":""),children:le(e)},e)}))]})]}),s.jsx("tbody",{children:"success"===l?e.map((e=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o(u?"bg-transparent text-gray-300":"bg-neutral-700 text-white"),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),s.jsx("td",{className:o(u?"dark:bg-transparent":"bg-neutral-700"),colSpan:2*(24-c)})]}),e.rooms.sort(((e,t)=>e.name<t.name?-1:1)).map(((e,r)=>{let a=0,n=r%2?u?"dark:bg-base-100":"bg-white":u?"dark:bg-base-300":"bg-gray-100";return s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o("border",n),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),ie(1,2*(d-c)+1).map((r=>{if(a>0)return a--,null;const i=((e,t)=>{const r=--t%2*30;return`${(e+Math.floor(t/2)).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:00`})(c,r);var l=o(u?"hover:bg-neutral-600":"hover:bg-gray-200",n);const d=(b=e.id,f=i,0!==(t??[]).length&&(t??[]).find((e=>e.room.id===b&&e.start_borrowing_time+":00"===f)));var b,f,h=1;d&&(l="bg-green-300 hover:bg-green-500",h=((e,t)=>{const r=new Date(`1970-01-01T${e}Z`);return(new Date(`1970-01-01T${t}Z`).getTime()-r.getTime())/6e4})(d.start_borrowing_time.toString(),d.end_event_time.toString())/30,"23:59:00"===d.end_event_time.toString()&&h++,a=h-1);const p=(r-1)%2==0;return s.jsx("td",{onClick:()=>{if(!d)return;if(d.borrowed_by_user_id!==(null==g?void 0:g.id)&&(null==g?void 0:g.role)!==m)return;const e="/room-request/"+d.id;window.open(e,"_blank")},className:o("border w-4 h-8 cursor-pointer -z-10",p?"border-l-4":"",l),colSpan:h},r)}))]},r)}))]},e.id))):s.jsx(ue,{isDarkTheme:u,startHour:c})})]})})]})},ue=({isDarkTheme:e,startHour:t})=>s.jsx("tr",{className:"border",children:s.jsx("th",{className:o(e?"bg-transparent text-gray-300 border-b":"bg-neutral-700 text-white"),colSpan:2*(24-t)+1,children:s.jsxs("span",{className:"w-32 flex flex-row items-end gap-0.5",children:["Loading",s.jsx("span",{className:"loading loading-dots loading-xs"})]})})});class me extends i{static async getRoomSchedules(){const{data:e}=await this._get("https://booking-api.reginacaeli.id/general/room-schedule");return e.floors}static async getSchedules(e){try{const{data:t}=await this._get("https://booking-api.reginacaeli.id/general/schedule",e);return t.borrowedRooms}catch(t){throw new Error(t.message)}}}const ge=()=>{const e=(()=>{const e=new Date;return e.setMinutes(0,0,0),e})(),[t,r]=l.useState([]),[a,n]=l.useState({date:f(e,"yyyy-MM-dd"),startTime:f(e,"HH")+":00",endTime:"23:59"}),[o,i]=l.useState({date:f(e,"yyyy-MM-dd"),startTime:f(e,"HH")+":00",endTime:"23:59"}),{data:m,status:h}=(()=>{const{data:e,status:t}=g({queryKey:["general/room-schedules"],queryFn:()=>me.getRoomSchedules()});return{data:e,status:t}})(),{data:p,status:j}=(e=>{const{data:t,status:r}=g({queryKey:["general/schedule",e],queryFn:()=>me.getSchedules(e),placeholderData:(e,t)=>e||void 0});return{data:t,status:r}})(o);return s.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4 mb-24",children:[s.jsx(c,{pageName:"Jadwal"}),s.jsxs("div",{className:"mx-6 flex flex-row items-end gap-4",children:[s.jsx(u,{type:"date",min:e.toISOString().split("T")[0],label:"Tanggal Booking",value:a.date,onChange:e=>{const t=e.target.value;n((e=>({...e,date:t})))}}),s.jsx(u,{type:"time",label:"Jam Awal Booking",value:a.startTime,onChange:e=>n((t=>({...t,startTime:e.target.value})))}),s.jsx(u,{type:"time",label:"Jam Akhir Booking",value:a.endTime,onChange:e=>n((t=>({...t,endTime:e.target.value})))}),s.jsx("button",{className:"btn btn-primary",type:"button",onClick:()=>{const e=new Date(`${a.date} ${a.startTime}`).getHours(),t=new Date(`${a.date} ${a.endTime}`).getHours();t<e?r([{message:"Jam Akhir Booking tidak boleh kurang dari Jam Awal Booking!"}]):t-e<1?r([{message:"Jam Akhir Booking harus memiliki jarak minimal 1 jam dari Jam Awal Booking!"}]):(r([]),i(a))},children:"Cari"})]}),s.jsx(b,{notification:t}),s.jsx("div",{className:"mx-6",children:s.jsx(de,{floors:m,borrowedRooms:p,selectedRange:o,status:d(j,h)})})]})};export{ge as default};
