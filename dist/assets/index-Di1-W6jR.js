import{B as e,c as t,f as a,h as r,r as s,Q as n,i,k as o,j as l}from"./index-BT4yNJiJ.js";import{P as c}from"./PageHeader-Dv_8xu8d.js";import{u,D as m}from"./use-item-BXT_bV0q.js";import{T as d,P as h}from"./Table-BEGMAotu.js";import{u as f,I as p}from"./InputText-BdcDWvtD.js";import"./useQuery-G1FIbsiR.js";const g="https://booking-api.reginacaeli.id/admin/item";class b extends e{static async createItem(e){try{return await this._post(`${g}`,e)}catch(t){throw new Error(t.message)}}static async updateItem(e,t){if(!e)return null;try{return await this._patch(`${g}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteItem(e){if(e)try{return await this._delete(`${g}/${e}`,{})}catch(t){throw new Error(t.message)}}}const x=s.forwardRef((({selectedItem:e},c)=>{const[u,m]=s.useState(e);s.useEffect((()=>{if(!e)return void m(void 0);const t={...e};m(t)}),[e]);const{register:d,setValue:h,errors:g,handleManageItem:x,handleDeleteItem:y,handleSubmit:j}=((e=null)=>{const{register:l,setValue:c,formState:{errors:u},handleSubmit:m,watch:d,reset:h}=f(),[p,g]=t(a),x=r();return s.useEffect((()=>{h(),e&&Object.keys(e).forEach((t=>{c(t,e[t])}))}),[e,c]),{register:l,setValue:c,errors:u,handleManageItem:async function(t){if(!p){g(!0);try{e?await n.promise(b.updateItem(e.id,t),{pending:"Waiting for update item!",error:i(),success:o()}):await n.promise(b.createItem(t),{pending:"Waiting for create item!",error:i(),success:o()})}catch(a){}x.invalidateQueries({queryKey:["general/item"]}),null!==e&&x.invalidateQueries({queryKey:["general/item",e.id]}),h(),g(!1)}},handleDeleteItem:async function(){if(e&&!p){g(!0);try{await n.promise(b.deleteItem(e.id),{pending:"Waiting for delete item!",error:i(),success:o()})}catch(t){}g(!1),h(),x.invalidateQueries({queryKey:["general/item"]})}},handleSubmit:m,watch:d}})(u);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Barang":"Buat Barang"}),l.jsxs("form",{onSubmit:j(x),className:"flex flex-col gap-2",children:[l.jsx(p,{label:"Nama Barang",type:"text",name:"name",register:d("name",{required:"Nama barang harus diisi"}),setValue:h,placeholder:"Cth: Speaker Portable",errors:g}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>{var e;return null==(e=c.current)?void 0:e.close()},children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",onClick:()=>{var e;return null==(e=c.current)?void 0:e.close()},children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>{var e;return await y(),null==(e=c.current)?void 0:e.close()},children:"Hapus"})]})]})]})})),y=[{name:"name",sortable:!0},{name:"room_at",sortable:!1}],j=()=>{const[e,t]=s.useState({page:1}),[a,r]=s.useState({order_by:"name",data_order:"asc"}),{data:n,status:i}=u(e,a,!0),o=n,f=null==o?void 0:o.data.map((e=>{const t={...e,room_at:(e.room_items??[]).map((e=>e.room.name)).join(", ")};return{...t,room_at:t.room_at?t.room_at:"-",onClick:()=>{var e;g(t),null==(e=b.current)||e.showModal()}}})),[p,g]=s.useState(),b=s.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(c,{pageName:"Barang",action:l.jsx(m,{buttonText:"Tambah Barang",onClick:()=>g(void 0),ref:b,children:l.jsx(x,{selectedItem:p,ref:b})})}),l.jsx(d,{header:y,data:f??[],status:i,sortData:a,setSortData:r,enableSort:!0}),l.jsx(h,{status:i,data:o,page:e.page,setPage:t})]})};export{j as default};
