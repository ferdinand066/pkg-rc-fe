import{p as e,q as t,u as r,e as a,a as n,j as s,t as o,r as l,B as i,v as c,w as d}from"./index-CELXcd2A.js";import{I as u}from"./InputText-Dh-9wUwK.js";import{P as m}from"./PageHeader-CyIXQTOD.js";import{B as b,A as g,I as f}from"./constants-5vXSpW5c.js";import{f as h}from"./format-IAjOZvHA.js";import{u as x}from"./useQuery-CypUoy4z.js";import{A as p}from"./AlertContainer-D7idTfHl.js";import"./startOfDay-Do9sk2vp.js";import"./isValid-5aXsojdQ.js";var j=Math.ceil,v=Math.max;var y=function(e,t,r,a){for(var n=-1,s=v(j((t-e)/(r||1)),0),o=Array(s);s--;)o[a?s:++n]=e,e+=r;return o};var w=function(e,t){return e===t||e!=e&&t!=t},N="object"==typeof e&&e&&e.Object===Object&&e,k="object"==typeof self&&self&&self.Object===Object&&self,_=(N||k||Function("return this")()).Symbol,S=_,M=Object.prototype,D=M.hasOwnProperty,$=M.toString,C=S?S.toStringTag:void 0;var B=function(e){var t=D.call(e,C),r=e[C];try{e[C]=void 0;var a=!0}catch(s){}var n=$.call(e);return a&&(t?e[C]=r:delete e[C]),n},H=Object.prototype.toString;var A=B,O=function(e){return H.call(e)},R=_?_.toStringTag:void 0;var T=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":R&&R in Object(e)?A(e):O(e)};var q=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},F=T,J=q;var I=function(e){if(!J(e))return!1;var t=F(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t},E=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var L=/^(?:0|[1-9]\d*)$/;var z=w,P=function(e){return null!=e&&E(e.length)&&!I(e)},K=function(e,t){var r=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==r||"symbol"!=r&&L.test(e))&&e>-1&&e%1==0&&e<t},W=q;var Z=/\s/;var G=function(e){for(var t=e.length;t--&&Z.test(e.charAt(t)););return t},Q=/^\s+/;var U=T,V=function(e){return null!=e&&"object"==typeof e};var X=function(e){return e?e.slice(0,G(e)+1).replace(Q,""):e},Y=q,ee=function(e){return"symbol"==typeof e||V(e)&&"[object Symbol]"==U(e)},te=/^[-+]0x[0-9a-f]+$/i,re=/^0b[01]+$/i,ae=/^0o[0-7]+$/i,ne=parseInt;var se=function(e){if("number"==typeof e)return e;if(ee(e))return NaN;if(Y(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Y(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=X(e);var r=re.test(e);return r||ae.test(e)?ne(e.slice(2),r?2:8):te.test(e)?NaN:+e},oe=1/0;var le=y,ie=function(e,t,r){if(!W(r))return!1;var a=typeof t;return!!("number"==a?P(r)&&K(t,r.length):"string"==a&&t in r)&&z(r[t],e)},ce=function(e){return e?(e=se(e))===oe||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const de=t(function(e){return function(t,r,a){return a&&"number"!=typeof a&&ie(t,r,a)&&(r=a=void 0),t=ce(t),void 0===r?(r=t,t=0):r=ce(r),a=void 0===a?t<r?1:-1:ce(a),le(t,r,a,e)}}()),ue=e=>(30*((e%2==0?2:e%2)-1)).toString().padStart(2,"0"),me=({name:e,labelColor:t})=>s.jsxs("div",{className:"flex flex-row gap-1 items-center",children:[s.jsx("span",{className:o(t,"size-5 border rounded")}),s.jsx("span",{children:e})]}),be=({floors:e,borrowedRooms:t,selectedRange:l,status:i})=>{const c=new Date(`${l.date} ${l.start_time}`).getHours();let d=new Date(`${l.date} ${l.end_time}`).getHours()+1;const u="dark"===r(a),{user:m}=n();return s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("div",{className:"flex flex-row justify-end p-4 gap-4",children:[s.jsx(me,{name:"Telah dibook",labelColor:"bg-yellow-300"}),s.jsx(me,{name:"Disetujui",labelColor:"bg-green-300"})]}),s.jsx("div",{id:"table-container",className:o("overflow-auto scrollbar-hide",""),children:s.jsxs("table",{className:"table table-sm table-pin-rows table-pin-cols",children:[s.jsxs("thead",{className:"border",children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32",children:"Booking pada:"}),de(c,d).map((e=>s.jsx("td",{className:"border border-l-4",colSpan:2,children:`${e}:00`},e)))]}),s.jsxs("tr",{className:"top-8 border",children:[s.jsx("th",{className:"border w-32 h-8 z-30 min-w-32",children:h(l.date,"dd MMM yyyy")}),de(1,2*(d-c)+1).map((e=>{const t=(e-1)%2==0;return s.jsx("td",{className:o("border w-8 h-8",t?"border-l-4":""),children:ue(e)},e)}))]})]}),s.jsx("tbody",{children:"success"===i?e.map((e=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o(u?"bg-transparent text-gray-300":"bg-neutral-700 text-white"),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),s.jsx("td",{className:o(u?"dark:bg-transparent":"bg-neutral-700"),colSpan:2*(24-c)})]}),e.rooms.sort(((e,t)=>e.name<t.name?-1:1)).map(((e,r)=>{let a=0,n=r%2?u?"dark:bg-base-100":"bg-white":u?"dark:bg-base-300":"bg-gray-100";return s.jsxs("tr",{className:"border",children:[s.jsx("th",{className:o("border",n),children:s.jsx("span",{className:"w-32 inline-block",children:e.name})}),de(1,2*(d-c)+1).map((r=>{if(a>0)return a--,null;const i=((e,t)=>{const r=--t%2*30;return`${(e+Math.floor(t/2)).toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}:00`})(c,r);var d=o(u?"hover:bg-neutral-600":"hover:bg-gray-200",n);const f=(h=e.id,x=i,0!==(t??[]).length&&(t??[]).find((e=>{if(e.room.id!==h)return!1;const t=e.start_borrowing_time+":00";if(t===x)return!0;const r=l.start_time+":00";return x===r&&t<r+":00"})));var h,x,p=1;f&&(d=f.borrowed_status===b?"bg-yellow-300 hover:bg-yellow-500 transition-all":"bg-green-300 hover:bg-green-500 transition-all",u&&(d=o(d,"text-black font-semibold")),p=Math.ceil(((e,t)=>{const r=new Date(`1970-01-01T${e}Z`);return(new Date(`1970-01-01T${t}Z`).getTime()-r.getTime())/6e4})(i,f.end_event_time.toString())/30),"23:59:00"===f.end_event_time.toString()&&p++,a=p-1);const j=(r-1)%2==0;return s.jsx(ge,{transactionDetailRoom:f,boldLeft:j,columnColor:d,colSpan:p,clickable:!!f&&(f.borrowed_by_user_id===(null==m?void 0:m.id)||(null==m?void 0:m.role)===g)},r)}))]},r)}))]},e.id))):s.jsx(fe,{isDarkTheme:u,startHour:c})})]})})]})},ge=({transactionDetailRoom:e,boldLeft:t,columnColor:r,colSpan:a,clickable:n})=>{const[i,c]=l.useState(!0),d=l.useRef(null);return l.useEffect((()=>{const e=()=>{var e;const t=null==(e=d.current)?void 0:e.closest("tr").querySelector("th");if(t&&d.current){const e=t.getBoundingClientRect(),r=d.current.getBoundingClientRect().left-e.left;c(!(r<150))}},t=document.getElementById("table-container");return null==t||t.addEventListener("scroll",e),()=>{null==t||t.removeEventListener("scroll",e)}}),[]),s.jsx("td",{ref:d,onClick:()=>{if(!e)return;if(!n)return;const t="/room-request/"+e.id;window.open(t,"_blank")},className:o("border w-8 h-8 cursor-pointer -z-10",t?"border-l-4":"",r),colSpan:a,children:e&&s.jsxs("div",{className:o("group cursor-pointer",i?"relative":""),children:[s.jsx("div",{className:"truncate",style:{maxWidth:2*a+"rem"},children:e.event_name}),s.jsxs("span",{className:"absolute -top-14 left-1/2 -translate-x-1/2 scale-0 transition-transform duration-200 ease-out group-hover:scale-100 p-2 text-xs text-white bg-gray-800 rounded-md shadow-lg flex flex-col min-w-32",children:[s.jsx("span",{children:`${e.start_borrowing_time} - ${e.end_event_time}`}),s.jsxs("span",{children:[e.pic_name," (",e.pic_phone_number,")"]})]})]})})},fe=({isDarkTheme:e,startHour:t})=>s.jsx("tr",{className:"border",children:s.jsx("th",{className:o(e?"bg-transparent text-gray-300 border-b":"bg-neutral-700 text-white"),colSpan:2*(24-t)+1,children:s.jsxs("span",{className:"w-32 flex flex-row items-end gap-0.5",children:["Loading",s.jsx("span",{className:"loading loading-dots loading-xs"})]})})});class he extends i{static async getRoomSchedules(){const{data:e}=await this._get("https://booking-api.reginacaeli.id/general/room-schedule");return e.floors}static async getSchedules(e){try{const{data:t}=await this._get("https://booking-api.reginacaeli.id/general/schedule",e);return t.borrowedRooms}catch(t){throw new Error(t.message)}}}const xe=()=>{const e=(()=>{const e=new Date;return e.getHours()>18&&e.setHours(18),e.setMinutes(0,0,0),e})(),[t,n]=l.useState([]),i="dark"===r(a),[b,g]=l.useState({date:h(e,"yyyy-MM-dd"),start_time:h(e,"HH")+":00",end_time:"23:59"}),[j,v]=l.useState({date:h(e,"yyyy-MM-dd"),start_time:h(e,"HH")+":00",end_time:"23:59"}),{data:y,status:w}=(()=>{const{data:e,status:t}=x({queryKey:["general/room-schedules"],queryFn:()=>he.getRoomSchedules()});return{data:e,status:t}})(),{data:N,status:k}=(e=>{const{data:t,status:r}=x({queryKey:["general/schedule",e],queryFn:()=>he.getSchedules(e),placeholderData:(e,t)=>e||void 0});return{data:t,status:r}})(j),_=e=>{const{date:t}=j,r=new Date(t);e(r);const a=h(r,"yyyy-MM-dd");g((e=>({...e,date:a}))),v((e=>({...e,date:a})))};return s.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4 mb-24",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center",children:[s.jsx(m,{pageName:"Jadwal"}),s.jsx("div",{className:"px-6 w-full flex justify-end",children:s.jsxs("div",{className:"join w-full sm:w-auto",children:[s.jsx("button",{onClick:()=>_((e=>e.setDate(e.getDate()+1))),className:o("btn join-item flex-1",i?"bg-neutral":"bg-white"),children:"Next Day"}),s.jsx("button",{onClick:()=>_((e=>e.setDate(e.getDate()+7))),className:o("btn join-item flex-1",i?"bg-neutral":"bg-white"),children:"Next Week"}),s.jsx("button",{onClick:()=>_((e=>e.setMonth(e.getMonth()+1))),className:o("btn join-item flex-1",i?"bg-neutral":"bg-white"),children:"Next Month"})]})})]}),s.jsxs("div",{className:"mx-6 flex flex-col md:flex-row items-end gap-4",children:[s.jsx(u,{type:"date",min:e.toISOString().split("T")[0],label:"Tanggal Booking",value:b.date,onChange:e=>{const t=e.target.value;g((e=>({...e,date:t})))}}),s.jsx(u,{type:"time",step:f,label:"Jam Awal Booking",value:b.start_time,onChange:e=>g((t=>({...t,start_time:e.target.value})))}),s.jsx(u,{type:"time",step:f,label:"Jam Akhir Booking",value:b.end_time,onChange:e=>g((t=>({...t,end_time:e.target.value})))}),s.jsx("button",{className:"btn btn-primary w-full md:w-auto",type:"button",onClick:()=>{const e=new Date(`${b.date} ${b.start_time}`).getHours(),t=new Date(`${b.date} ${b.end_time}`).getHours();if(t<e)n([{message:"Jam Akhir Booking tidak boleh kurang dari Jam Awal Booking!"}]);else if(t-e<1)n([{message:"Jam Akhir Booking harus memiliki jarak minimal 1 jam dari Jam Awal Booking!"}]);else{if(t-e<6){let r=e,a=t;const n=Math.floor((e+t)/2);e<=6?(r=0,a=6):e>=18?(r=18,a=23):(r=Math.max(0,n-Math.floor(3)),a=Math.min(23,r+6));const s={...b,start_time:c.padStart(r.toString(),2,"0")+":00",end_time:c.padStart(a.toString(),2,"0")+":00"};g(s),v(s)}else v(b);n([])}},children:"Cari"})]}),s.jsx(p,{notification:t}),s.jsx("div",{className:"mx-6",children:s.jsx(be,{floors:y,borrowedRooms:N,selectedRange:j,status:d(k,w)})})]})};export{xe as default};
