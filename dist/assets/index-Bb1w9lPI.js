import{B as e,d as t,f as a,h as s,r,Q as i,i as o,k as n,j as m}from"./index-BMio7b_C.js";import{P as l}from"./PageHeader-oQ2FRQ3y.js";import{D as u}from"./DialogButton-DlMTBw2t.js";import{T as c,P as d}from"./Table-Ca3o5cGV.js";import{u as p}from"./use-room-CZ7BsnTR.js";import{I as f}from"./InputSelect-BKT60kPV.js";import{u as g,I as h}from"./InputText-C-iQ4tFZ.js";import{I as j}from"./InputToggle-BPG4zHPL.js";import{u as y}from"./use-floor-DAO5QQrh.js";import{u as b}from"./use-item-CzSLQVbZ.js";import"./useQuery-8fHC9d-I.js";import"./isValid-5aXsojdQ.js";const x="https://booking-api.parokipik.org/admin/room";class _ extends e{static async createRoom(e){try{return await this._post(`${x}`,e)}catch(t){throw new Error(t.message)}}static async updateRoom(e,t){if(!e)return null;try{return await this._patch(`${x}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteRoom(e){if(e)try{return await this._delete(`${x}/${e}`,{})}catch(t){throw new Error(t.message)}}}const w=r.forwardRef((({selectedRoom:e},l)=>{const{data:u,status:c}=y({order_by:"created_at",data_order:"asc"}),{data:d,status:p}=b({},{order_by:"name",data_order:"asc"},!1),[x,w]=r.useState(e),R=d;r.useEffect((()=>{if("success"!==p)return;if(!e)return void w(void 0);const t=new Map;R?.forEach(((e,a)=>t.set(e.id,a)));const a=new Array(R?.length??0);for(const r of e?.item_id??[]){const e=t.get(r);void 0!==e&&(a[e]=r)}const s={...e,item_id:a};w(s)}),[p,e]);const{register:v,setValue:N,errors:$,handleManageRoom:q,handleDeleteRoom:S,handleSubmit:V,watch:k}=((e=null)=>{const{register:m,setValue:l,getValues:u,formState:{errors:c},handleSubmit:d,watch:p,reset:f}=g(),[h,j]=t(a),y=s();return r.useEffect((()=>{f(),e&&(Object.keys(e).filter((e=>!["room_items","item_id"].includes(e))).forEach((t=>{l(t,e[t])})),e.room_items?.map((t=>{const a=e.item_id?.indexOf(t.item_id);void 0!==a&&(a<0||(l(`items.${a}.item_id`,t.item_id),l(`items.${a}.quantity`,t.quantity)))})))}),[e,l]),{register:m,setValue:l,getValues:u,errors:c,handleManageRoom:async function(t){if(!h){t={...t,items:t.items.filter((e=>!!e.item_id))},j(!0);try{e?await i.promise(_.updateRoom(e.id,t),{pending:"Waiting for update room!",error:n(),success:o()}):await i.promise(_.createRoom(t),{pending:"Waiting for create room!",error:n(),success:o()})}catch(a){}y.invalidateQueries({queryKey:["general/room"]}),null!==e&&y.invalidateQueries({queryKey:["general/room",e.id]}),f(),j(!1)}},handleDeleteRoom:async function(){if(e&&!h){j(!0);try{await i.promise(_.deleteRoom(e.id),{pending:"Waiting for delete room!",error:n(),success:o()})}catch(t){}j(!1),f(),y.invalidateQueries({queryKey:["general/room"]})}},handleSubmit:d,watch:p}})(x);return m.jsxs(m.Fragment,{children:[m.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Ruangan":"Buat Ruangan"}),m.jsxs("form",{onSubmit:V((async e=>{await q(e),l.current?.close()})),className:"flex flex-col gap-2",children:[m.jsx(h,{label:"Nama Ruangan",type:"text",name:"name",register:v("name",{required:"Nama ruangan harus diisi"}),setValue:N,placeholder:"Cth: Bartolomeus",errors:$}),"success"===c?m.jsx(f,{label:"Lantai",name:"floor_id",register:v("floor_id",{required:"Lantai harus diisi"}),setValue:N,model:u??[],errors:$}):m.jsx(m.Fragment,{}),m.jsx(h,{label:"Kapasitas",type:"number",name:"capacity",register:v("capacity",{required:"Kapasitas harus diisi"}),min:1,setValue:N,errors:$}),m.jsx("span",{}),"success"===p?R?.map(((e,t)=>{const a=k(`items.${t}.item_id`);return m.jsxs("div",{className:"grid grid-cols-3 items-center",children:[m.jsx(j,{label:e.name,name:`items.${t}.item_id`,id:`items.${t}.item_i d`,value:e.id,register:v(`items.${t}.item_id`),inputContainerClassName:"col-span-2",errors:$}),!!a&&m.jsx(h,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${t}.quantity`,id:`items.${t}.quantity`,register:v(`items.${t}.quantity`,{required:"Harus diisi"}),errors:$})]},e.id)})):m.jsx(m.Fragment,{}),m.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[m.jsxs("div",{className:"flex flex-row gap-4",children:[m.jsx("button",{className:"btn",type:"button",onClick:()=>l.current?.close(),children:"Tutup"}),m.jsx("button",{className:"btn btn-primary",type:"submit",children:e?"Ubah":"Buat"})]}),e&&m.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>(await S(),l.current?.close()),children:"Hapus"})]})]})]})})),R=[{name:"name",sortable:!0},{name:"floor_name",sortable:!0},{name:"items",sortable:!1}],v=()=>{const[e,t]=r.useState({page:1}),[a,s]=r.useState({order_by:"name",data_order:"asc"}),{data:i,status:o}=p(e,a,!0),n=i,f=n?.data.map((e=>{const t={...e,floor_name:e.floor.name,items:e?.room_items?.map((e=>e.item.name)).join(", "),item_id:e?.room_items?.map((e=>e.item_id))};return{...t,items:t.items?t.items:"-",onClick:()=>{h(t),j.current?.showModal()}}})),[g,h]=r.useState(),j=r.useRef(null);return m.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[m.jsx(l,{pageName:"Ruangan",action:m.jsx(u,{buttonValue:"Tambah Ruangan",onClick:()=>h(void 0),ref:j,children:m.jsx(w,{selectedRoom:g,ref:j})})}),m.jsx(c,{header:R,data:f??[],status:o,sortData:a,setSortData:s,enableSort:!0}),m.jsx(d,{status:o,data:n,page:e.page,setPage:t})]})};export{v as default};
