import{B as e,c as t,f as a,h as r,r as s,Q as i,i as o,k as n,j as l}from"./index-BT4yNJiJ.js";import{P as m}from"./PageHeader-Dv_8xu8d.js";import{u,D as c}from"./use-item-BXT_bV0q.js";import{T as d,P as g}from"./Table-BEGMAotu.js";import{u as p}from"./use-room-qBG8kIEp.js";import{I as f}from"./InputSelect-BztCjkQi.js";import{u as h,I as y}from"./InputText-BdcDWvtD.js";import{I as x}from"./InputToggle--XBLvL8z.js";import{u as b}from"./useQuery-G1FIbsiR.js";import"./isValid-5aXsojdQ.js";const j="https://booking-api.reginacaeli.id/admin/room";class _ extends e{static async createRoom(e){try{return await this._post(`${j}`,e)}catch(t){throw new Error(t.message)}}static async updateRoom(e,t){if(!e)return null;try{return await this._patch(`${j}/${e}`,t)}catch(a){throw new Error(a.message)}}static async deleteRoom(e){if(e)try{return await this._delete(`${j}/${e}`,{})}catch(t){throw new Error(t.message)}}}const v="https://booking-api.reginacaeli.id/general/floor";class w extends e{static async getFloors(e){try{const{data:t}=await this._get(`${v}`,e);return t.floors}catch(t){throw new Error(t.message)}}static async getOneFloor(e){if(!e)return null;try{const{data:t}=await this._get(`${v}/${e}`);return t.floor}catch(t){throw new Error(t.message)}}}const R=s.forwardRef((({selectedRoom:e},m)=>{const{data:c,status:d}=(e=>{const{data:t,status:a}=b({queryKey:["general/floor",e],queryFn:()=>w.getFloors(e)});return{data:t,status:a}})({order_by:"created_at",data_order:"asc"}),{data:g,status:p}=u({},{order_by:"name",data_order:"asc"},!1),[j,v]=s.useState(e),R=g;s.useEffect((()=>{if("success"!==p)return;if(!e)return void v(void 0);const t=new Map;null==R||R.forEach(((e,a)=>t.set(e.id,a)));const a=new Array((null==R?void 0:R.length)??0);for(const s of(null==e?void 0:e.item_id)??[]){const e=t.get(s);void 0!==e&&(a[e]=s)}const r={...e,item_id:a};v(r)}),[p,e]);const{register:$,setValue:q,errors:N,handleManageRoom:S,handleDeleteRoom:k,handleSubmit:E,watch:V}=((e=null)=>{const{register:l,setValue:m,getValues:u,formState:{errors:c},handleSubmit:d,watch:g,reset:p}=h(),[f,y]=t(a),x=r();return s.useEffect((()=>{var t;p(),e&&(Object.keys(e).filter((e=>!["room_items","item_id"].includes(e))).forEach((t=>{m(t,e[t])})),null==(t=e.room_items)||t.map((t=>{var a;const r=null==(a=e.item_id)?void 0:a.indexOf(t.item_id);void 0!==r&&(r<0||(m(`items.${r}.item_id`,t.item_id),m(`items.${r}.quantity`,t.quantity)))})))}),[e,m]),{register:l,setValue:m,getValues:u,errors:c,handleManageRoom:async function(t){if(!f){t={...t,items:t.items.filter((e=>!!e.item_id))},y(!0);try{e?await i.promise(_.updateRoom(e.id,t),{pending:"Waiting for update room!",error:o(),success:n()}):await i.promise(_.createRoom(t),{pending:"Waiting for create room!",error:o(),success:n()})}catch(a){}x.invalidateQueries({queryKey:["general/room"]}),null!==e&&x.invalidateQueries({queryKey:["general/room",e.id]}),p(),y(!1)}},handleDeleteRoom:async function(){if(e&&!f){y(!0);try{await i.promise(_.deleteRoom(e.id),{pending:"Waiting for delete room!",error:o(),success:n()})}catch(t){}y(!1),p(),x.invalidateQueries({queryKey:["general/room"]})}},handleSubmit:d,watch:g}})(j);return l.jsxs(l.Fragment,{children:[l.jsx("h3",{className:"font-bold text-lg",children:e?"Ubah Ruangan":"Buat Ruangan"}),l.jsxs("form",{onSubmit:E((async e=>{var t;await S(e),null==(t=m.current)||t.close()})),className:"flex flex-col gap-2",children:[l.jsx(y,{label:"Nama Ruangan",type:"text",name:"name",register:$("name",{required:"Nama ruangan harus diisi"}),setValue:q,placeholder:"Cth: Bartolomeus",errors:N}),"success"===d?l.jsx(f,{label:"Lantai",name:"floor_id",register:$("floor_id",{required:"Lantai harus diisi"}),setValue:q,model:c??[],errors:N}):l.jsx(l.Fragment,{}),l.jsx(y,{label:"Kapasitas",type:"number",name:"capacity",register:$("capacity",{required:"Kapasitas harus diisi"}),min:1,setValue:q,errors:N}),l.jsx("span",{}),"success"===p?null==R?void 0:R.map(((e,t)=>{const a=V(`items.${t}.item_id`);return l.jsxs("div",{className:"grid grid-cols-3 items-center",children:[l.jsx(x,{label:e.name,name:`items.${t}.item_id`,id:`items.${t}.item_i d`,value:e.id,register:$(`items.${t}.item_id`),inputContainerClassName:"col-span-2",errors:N}),!!a&&l.jsx(y,{type:"number",inputClassName:"input-sm",placeholder:"Jumlah barang",min:1,name:`items.${t}.quantity`,id:`items.${t}.quantity`,register:$(`items.${t}.quantity`,{required:"Harus diisi"}),errors:N})]},e.id)})):l.jsx(l.Fragment,{}),l.jsxs("div",{className:"modal-action flex-row-reverse justify-between",children:[l.jsxs("div",{className:"flex flex-row gap-4",children:[l.jsx("button",{className:"btn",type:"button",onClick:()=>{var e;return null==(e=m.current)?void 0:e.close()},children:"Tutup"}),l.jsx("button",{className:"btn btn-primary",type:"submit",children:e?"Ubah":"Buat"})]}),e&&l.jsx("button",{className:"btn !ml-0 btn-error",type:"button",onClick:async()=>{var e;return await k(),null==(e=m.current)?void 0:e.close()},children:"Hapus"})]})]})]})})),$=[{name:"name",sortable:!0},{name:"floor_name",sortable:!0},{name:"items",sortable:!1}],q=()=>{const[e,t]=s.useState({page:1}),[a,r]=s.useState({order_by:"name",data_order:"asc"}),{data:i,status:o}=p(e,a,!0),n=i,u=null==n?void 0:n.data.map((e=>{var t,a;const r={...e,floor_name:e.floor.name,items:null==(t=null==e?void 0:e.room_items)?void 0:t.map((e=>e.item.name)).join(", "),item_id:null==(a=null==e?void 0:e.room_items)?void 0:a.map((e=>e.item_id))};return{...r,items:r.items?r.items:"-",onClick:()=>{var e;h(r),null==(e=y.current)||e.showModal()}}})),[f,h]=s.useState(),y=s.useRef(null);return l.jsxs("section",{className:"flex flex-col h-full flex-1 gap-4",children:[l.jsx(m,{pageName:"Ruangan",action:l.jsx(c,{buttonText:"Tambah Ruangan",onClick:()=>h(void 0),ref:y,children:l.jsx(R,{selectedRoom:f,ref:y})})}),l.jsx(d,{header:$,data:u??[],status:o,sortData:a,setSortData:r,enableSort:!0}),l.jsx(g,{status:o,data:n,page:e.page,setPage:t})]})};export{q as default};
